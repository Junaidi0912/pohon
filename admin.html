<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perpustakaan Abadi - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=MedievalSharp&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        parchment: '#F5E6CA',
                        oldPaper: '#E8D9B5',
                        darkBrown: '#8B4513',
                        gold: '#D4AF37',
                        silver: '#C0C0C0',
                        bronze: '#CD7F32',
                        mysticBlue: '#1E3A5F',
                        deepRed: '#8B0000',
                        forestGreen: '#228B22',
                        lightBrown: '#A0522D'
                    },
                    fontFamily: {
                        'cinzel': ['Cinzel', 'serif'],
                        'medieval': ['MedievalSharp', 'cursive'],
                        'maguntia': ['UnifrakturMaguntia', 'cursive']
                    },
                    spacing: {
                        '18': '4.5rem',
                        '88': '22rem',
                        '128': '32rem'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #2C1810 0%, #1A0F0A 50%, #0F0805 100%);
            min-height: 100vh;
        }
        
        .parchment-bg {
            background: linear-gradient(135deg, #F5E6CA 0%, #E8D9B5 50%, #DBC9A0 100%);
            border: 3px double #8B4513;
            box-shadow: 
                0 4px 20px rgba(139, 69, 19, 0.15),
                inset 0 0 30px rgba(139, 69, 19, 0.08);
        }
        
        .ancient-border {
            border: 2px solid transparent;
            border-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,0 L100,0 L100,100 L0,100 Z' fill='none' stroke='%238B4513' stroke-width='4' stroke-dasharray='12,6'/%3E%3C/svg%3E") 20 round;
        }
        
        .stats-card {
            transition: all 0.3s ease;
            border: 2px solid #8B4513;
            backdrop-filter: blur(10px);
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(139, 69, 19, 0.2);
        }
        
        .student-row {
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(139, 69, 19, 0.2);
        }
        
        .student-row:hover {
            background: linear-gradient(90deg, rgba(212, 175, 55, 0.08), rgba(139, 69, 19, 0.05));
            transform: translateX(4px);
        }
        
        .rank-progress {
            background: linear-gradient(90deg, #D4AF37, #8B4513);
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
        }

        /* Mobile First Design */
        .mobile-container {
            padding-left: 1rem;
            padding-right: 1rem;
        }
        
        @media (min-width: 768px) {
            .mobile-container {
                padding-left: 2rem;
                padding-right: 2rem;
            }
        }

        /* Custom scrollbar */
        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: #8B4513 #F5E6CA;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #F5E6CA;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #8B4513;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #A0522D;
        }

        /* Search highlight */
        .search-highlight {
            background-color: rgba(212, 175, 55, 0.4);
            border-radius: 3px;
            padding: 0 3px;
            font-weight: 600;
        }

        /* Filter buttons */
        .filter-btn {
            transition: all 0.3s ease;
            border: 2px solid #8B4513;
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.2);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #D4AF37, #8B4513);
            color: white;
            border-color: #8B4513;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
        }

        /* Online/Offline Status */
        .online-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 6px;
            box-shadow: 0 0 5px currentColor;
        }
        
        .status-online {
            background-color: #22c55e;
        }
        
        .status-offline {
            background-color: #ef4444;
        }

        /* Action buttons */
        .action-btn {
            transition: all 0.2s ease;
            border: 1.5px solid;
        }

        .action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Loading animation */
        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
            }
            50% { 
                box-shadow: 0 0 30px rgba(212, 175, 55, 0.6);
            }
        }

        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        /* Table responsive improvements */
        @media (max-width: 1024px) {
            .table-responsive {
                font-size: 0.875rem;
            }
            
            .table-responsive th,
            .table-responsive td {
                padding: 0.75rem 0.5rem;
            }
        }

        @media (max-width: 768px) {
            .mobile-stack {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }
            
            .mobile-text-center {
                text-align: center;
            }
            
            .mobile-full-width {
                width: 100%;
            }
        }

        /* Card hover effects */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(139, 69, 19, 0.15);
        }

        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, #D4AF37 0%, #8B4513 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="font-cinzel text-oldPaper min-h-screen">
    <!-- Navigation -->
    <nav class="bg-darkBrown/95 backdrop-blur-md shadow-2xl border-b-2 border-gold sticky top-0 z-50">
        <div class="mobile-container">
            <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center space-y-4 lg:space-y-0 py-4">
                <!-- Logo & Title -->
                <div class="flex items-center space-x-4 justify-center lg:justify-start">
                    <div class="w-12 h-12 bg-gradient-to-r from-gold to-bronze rounded-2xl flex items-center justify-center ancient-border pulse-glow">
                        <i class="fas fa-user-shield text-darkBrown text-xl"></i>
                    </div>
                    <div class="text-center lg:text-left">
                        <h1 class="text-2xl lg:text-3xl font-bold text-gold font-maguntia">Perpustakaan Abadi</h1>
                        <p class="text-silver text-sm lg:text-base font-medieval mt-1">Panel Administrator</p>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-3 justify-center lg:justify-end">
                    <button onclick="refreshData()" class="bg-gold hover:bg-yellow-600 text-darkBrown px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 border-2 border-darkBrown font-medieval text-sm lg:text-base flex items-center justify-center shadow-lg">
                        <i class="fas fa-sync-alt mr-3"></i>Perbarui Data
                    </button>
                    <a href="siswa.html" class="bg-forestGreen hover:bg-green-800 text-parchment px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 border-2 border-gold font-medieval text-sm lg:text-base flex items-center justify-center shadow-lg">
                        <i class="fas fa-eye mr-3"></i>Lihat Siswa
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="py-6 lg:py-8">
        <div class="mobile-container max-w-7xl mx-auto">
            <!-- Statistics Overview -->
            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
                <div class="stats-card parchment-bg rounded-2xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div class="space-y-2">
                            <div class="text-3xl lg:text-4xl font-bold text-darkBrown" id="total-students">0</div>
                            <div class="text-darkBrown font-medieval text-lg">Total Petualang</div>
                        </div>
                        <div class="w-14 h-14 bg-gold/20 rounded-2xl flex items-center justify-center ancient-border">
                            <i class="fas fa-users text-gold text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 w-full bg-oldPaper rounded-full h-2">
                        <div class="bg-gradient-to-r from-gold to-bronze h-2 rounded-full transition-all duration-1000" style="width: 100%"></div>
                    </div>
                </div>

                <div class="stats-card parchment-bg rounded-2xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div class="space-y-2">
                            <div class="text-3xl lg:text-4xl font-bold text-darkBrown" id="online-students">0</div>
                            <div class="text-darkBrown font-medieval text-lg">Sedang Online</div>
                        </div>
                        <div class="w-14 h-14 bg-forestGreen/20 rounded-2xl flex items-center justify-center ancient-border">
                            <i class="fas fa-wifi text-forestGreen text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 w-full bg-oldPaper rounded-full h-2">
                        <div class="bg-gradient-to-r from-forestGreen to-green-600 h-2 rounded-full transition-all duration-1000" id="online-progress" style="width: 0%"></div>
                    </div>
                </div>

                <div class="stats-card parchment-bg rounded-2xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div class="space-y-2">
                            <div class="text-3xl lg:text-4xl font-bold text-darkBrown" id="total-points">0</div>
                            <div class="text-darkBrown font-medieval text-lg">Total XP</div>
                        </div>
                        <div class="w-14 h-14 bg-gold/20 rounded-2xl flex items-center justify-center ancient-border">
                            <i class="fas fa-star text-gold text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-darkBrown font-medieval">
                        ⭐ Rata-rata: <span id="avg-points-display">0</span> XP
                    </div>
                </div>

                <div class="stats-card parchment-bg rounded-2xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div class="space-y-2">
                            <div class="text-3xl lg:text-4xl font-bold text-darkBrown" id="avg-points">0</div>
                            <div class="text-darkBrown font-medieval text-lg">Rata-rata XP</div>
                        </div>
                        <div class="w-14 h-14 bg-bronze/20 rounded-2xl flex items-center justify-center ancient-border">
                            <i class="fas fa-chart-line text-bronze text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-darkBrown font-medieval">
                        📈 Progress sistem
                    </div>
                </div>
            </div>

            <!-- Search and Filter Section -->
            <div class="parchment-bg rounded-2xl p-6 lg:p-8 ancient-border mb-8">
                <!-- Search Bar -->
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0 mb-6">
                    <div class="flex-1">
                        <div class="relative">
                            <input 
                                type="text" 
                                id="search-input"
                                placeholder="Cari nama petualang atau kelas..."
                                class="w-full px-6 py-4 bg-oldPaper border-3 border-darkBrown rounded-2xl focus:border-gold focus:ring-4 focus:ring-gold/20 transition-all duration-300 outline-none font-medieval text-lg placeholder-darkBrown/60 shadow-inner"
                            >
                            <div class="absolute right-4 top-1/2 transform -translate-y-1/2 text-darkBrown text-xl">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="adminSystem.clearSearch()" class="bg-silver hover:bg-gray-500 text-darkBrown px-6 py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-darkBrown font-medieval text-base flex items-center justify-center action-btn">
                            <i class="fas fa-times mr-2"></i>Clear
                        </button>
                        <button onclick="adminSystem.toggleSort()" class="bg-mysticBlue hover:bg-blue-800 text-parchment px-6 py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-gold font-medieval text-base flex items-center justify-center action-btn">
                            <i class="fas fa-sort-amount-down mr-2" id="sort-icon"></i>
                            <span id="sort-text">XP Tertinggi</span>
                        </button>
                    </div>
                </div>

                <!-- Filter by Class -->
                <div class="mb-6">
                    <h3 class="text-darkBrown font-semibold font-medieval text-lg mb-4">Filter Kelas:</h3>
                    <div class="grid grid-cols-3 sm:grid-cols-5 lg:grid-cols-10 gap-3">
                        <button onclick="adminSystem.filterByClass('')" class="filter-btn active bg-gold/20 text-darkBrown py-3 rounded-xl text-sm font-semibold font-medieval">
                            Semua
                        </button>
                        <button onclick="adminSystem.filterByClass('7A')" class="filter-btn bg-gold/20 text-darkBrown py-3 rounded-xl text-sm font-semibold font-medieval">
                            7A
                        </button>
                        <button onclick="adminSystem.filterByClass('7B')" class="filter-btn bg-gold/20 text-darkBrown py-3 rounded-xl text-sm font-semibold font-medieval">
                            7B
                        </button>
                        <button onclick="adminSystem.filterByClass('7C')" class="filter-btn bg-gold/20 text-darkBrown py-3 rounded-xl text-sm font-semibold font-medieval">
                            7C
                        </button>
                        <button onclick="adminSystem.filterByClass('8A')" class="filter-btn bg-gold/20 text-darkBrown py-3 rounded-xl text-sm font-semibold font-medieval">
                            8A
                        </button>
                        <button onclick="adminSystem.filterByClass('8B')" class="filter-btn bg-gold/20 text-darkBrown py-3 rounded-xl text-sm font-semibold font-medieval">
                            8B
                        </button>
                        <button onclick="adminSystem.filterByClass('8C')" class="filter-btn bg-gold/20 text-darkBrown py-3 rounded-xl text-sm font-semibold font-medieval">
                            8C
                        </button>
                        <button onclick="adminSystem.filterByClass('9A')" class="filter-btn bg-gold/20 text-darkBrown py-3 rounded-xl text-sm font-semibold font-medieval">
                            9A
                        </button>
                        <button onclick="adminSystem.filterByClass('9B')" class="filter-btn bg-gold/20 text-darkBrown py-3 rounded-xl text-sm font-semibold font-medieval">
                            9B
                        </button>
                        <button onclick="adminSystem.filterByClass('9C')" class="filter-btn bg-gold/20 text-darkBrown py-3 rounded-xl text-sm font-semibold font-medieval">
                            9C
                        </button>
                    </div>
                </div>

                <!-- Status Filter -->
                <div class="mb-4">
                    <h3 class="text-darkBrown font-semibold font-medieval text-lg mb-4">Filter Status:</h3>
                    <div class="flex flex-wrap gap-3">
                        <button onclick="adminSystem.filterByStatus('all')" class="filter-btn active bg-gold/20 text-darkBrown px-6 py-3 rounded-xl text-base font-semibold font-medieval">
                            Semua Status
                        </button>
                        <button onclick="adminSystem.filterByStatus('online')" class="filter-btn bg-gold/20 text-darkBrown px-6 py-3 rounded-xl text-base font-semibold font-medieval">
                            <span class="online-status status-online"></span>Online
                        </button>
                        <button onclick="adminSystem.filterByStatus('offline')" class="filter-btn bg-gold/20 text-darkBrown px-6 py-3 rounded-xl text-base font-semibold font-medieval">
                            <span class="online-status status-offline"></span>Offline
                        </button>
                    </div>
                </div>

                <!-- Search Results Info -->
                <div id="search-info" class="mt-4 p-4 bg-oldPaper rounded-xl border-2 border-darkBrown text-darkBrown font-medieval text-base hidden">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-info-circle text-gold"></i>
                        <span>Menampilkan <span class="font-bold text-darkBrown" id="result-count">0</span> dari <span class="font-bold text-darkBrown" id="total-count">0</span> petualang</span>
                        <span id="search-term-display" class="font-semibold text-gold"></span>
                    </div>
                </div>
            </div>

            <!-- Students List Section -->
            <div class="parchment-bg rounded-2xl overflow-hidden ancient-border mb-8">
                <!-- Header -->
                <div class="px-6 lg:px-8 py-6 border-b-2 border-darkBrown bg-gradient-to-r from-oldPaper to-parchment">
                    <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center space-y-4 lg:space-y-0">
                        <div>
                            <h3 class="text-2xl lg:text-3xl font-bold text-darkBrown font-maguntia mb-2">Daftar Petualang</h3>
                            <p class="text-darkBrown font-medieval text-lg">Kelola XP dan pantau progress literasi</p>
                        </div>
                        <div id="student-count" class="bg-gold/30 text-darkBrown px-6 py-3 rounded-xl text-base font-semibold border-2 border-darkBrown font-medieval">
                            <i class="fas fa-users mr-2"></i>
                            <span>0 petualang</span>
                        </div>
                    </div>
                </div>

                <!-- Table Container -->
                <div class="overflow-x-auto custom-scrollbar">
                    <table class="w-full min-w-[800px] lg:min-w-full">
                        <thead>
                            <tr class="bg-gradient-to-r from-oldPaper to-parchment">
                                <th class="px-6 py-5 text-left font-bold text-darkBrown font-medieval text-lg border-b-2 border-darkBrown">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-user text-gold"></i>
                                        <span>Nama Petualang</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-darkBrown font-medieval text-lg border-b-2 border-darkBrown">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-graduation-cap text-gold"></i>
                                        <span>Kelas</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-darkBrown font-medieval text-lg border-b-2 border-darkBrown">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-star text-gold"></i>
                                        <span>XP</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-darkBrown font-medieval text-lg border-b-2 border-darkBrown">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-trophy text-gold"></i>
                                        <span>Rank</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-darkBrown font-medieval text-lg border-b-2 border-darkBrown">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-signal text-gold"></i>
                                        <span>Status</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-darkBrown font-medieval text-lg border-b-2 border-darkBrown">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-cogs text-gold"></i>
                                        <span>Aksi</span>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="students-table-body" class="table-responsive">
                            <!-- Data siswa akan diisi di sini -->
                        </tbody>
                    </table>
                </div>

                <!-- Empty States -->
                <div class="mobile-text-center mobile-full-width">
                    <div class="mobile-px-4 mobile-py-16 border-t-2 border-darkBrown text-center text-darkBrown font-medieval" id="empty-state">
                        <i class="fas fa-scroll text-6xl mb-6 opacity-40"></i>
                        <p class="text-2xl mb-3">Belum ada petualang</p>
                        <p class="text-lg opacity-80">Arahkan siswa untuk login ke sistem</p>
                    </div>

                    <div class="mobile-px-4 mobile-py-16 border-t-2 border-darkBrown text-center text-darkBrown font-medieval hidden" id="no-results-state">
                        <i class="fas fa-search text-6xl mb-6 opacity-40"></i>
                        <p class="text-2xl mb-3">Tidak ditemukan</p>
                        <p class="text-lg opacity-80">Coba dengan kata kunci atau filter lain</p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions Section -->
            <div class="parchment-bg rounded-2xl p-6 lg:p-8 ancient-border">
                <h3 class="text-2xl lg:text-3xl font-bold text-darkBrown font-maguntia mb-6">Aksi Cepat Tambah XP</h3>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6">
                    <button onclick="showBulkAddModal(5)" class="parchment-bg hover:bg-gold/30 text-darkBrown py-6 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 border-3 border-darkBrown font-medieval text-lg flex flex-col items-center justify-center action-btn shadow-lg">
                        <i class="fas fa-plus-circle text-3xl mb-3 text-gold"></i>
                        <span>+5 XP</span>
                        <span class="text-sm opacity-70 mt-1">Tambah Sedikit</span>
                    </button>
                    <button onclick="showBulkAddModal(15)" class="parchment-bg hover:bg-gold/30 text-darkBrown py-6 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 border-3 border-darkBrown font-medieval text-lg flex flex-col items-center justify-center action-btn shadow-lg">
                        <i class="fas fa-plus-circle text-3xl mb-3 text-bronze"></i>
                        <span>+15 XP</span>
                        <span class="text-sm opacity-70 mt-1">Tambah Medium</span>
                    </button>
                    <button onclick="showBulkAddModal(20)" class="parchment-bg hover:bg-gold/30 text-darkBrown py-6 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 border-3 border-darkBrown font-medieval text-lg flex flex-col items-center justify-center action-btn shadow-lg">
                        <i class="fas fa-plus-circle text-3xl mb-3 text-gold"></i>
                        <span>+20 XP</span>
                        <span class="text-sm opacity-70 mt-1">Tambah Banyak</span>
                    </button>
                    <button onclick="showBulkAddModal(30)" class="parchment-bg hover:bg-gold/30 text-darkBrown py-6 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 border-3 border-darkBrown font-medieval text-lg flex flex-col items-center justify-center action-btn shadow-lg">
                        <i class="fas fa-plus-circle text-3xl mb-3 text-bronze"></i>
                        <span>+30 XP</span>
                        <span class="text-sm opacity-70 mt-1">Tambah Maximum</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Points Modal -->
    <div id="add-points-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center mobile-container backdrop-blur-sm">
        <div class="parchment-bg rounded-2xl p-8 w-full max-w-md ancient-border transform animate-grow">
            <div class="text-center mb-6">
                <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-gold to-bronze rounded-2xl flex items-center justify-center ancient-border">
                    <i class="fas fa-plus text-darkBrown text-3xl"></i>
                </div>
                <h4 class="text-2xl font-bold text-darkBrown font-maguntia">Tambah XP</h4>
            </div>
            <div class="space-y-6">
                <div>
                    <label class="block text-darkBrown font-semibold mb-3 font-medieval text-lg">Jumlah XP</label>
                    <input type="number" id="points-amount" 
                           class="w-full px-6 py-4 bg-oldPaper border-3 border-darkBrown rounded-2xl focus:border-gold focus:ring-4 focus:ring-gold/20 transition-all duration-300 outline-none font-medieval text-lg text-center"
                           min="1" max="100" value="5">
                </div>
                <div class="flex space-x-4">
                    <button onclick="addPointsToStudent()" class="flex-1 bg-gold hover:bg-yellow-600 text-darkBrown py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-darkBrown font-medieval text-lg shadow-lg hover:scale-105">
                        <i class="fas fa-check mr-2"></i>Tambah XP
                    </button>
                    <button onclick="closeAddPointsModal()" class="flex-1 bg-deepRed hover:bg-red-800 text-parchment py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-gold font-medieval text-lg shadow-lg hover:scale-105">
                        <i class="fas fa-times mr-2"></i>Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Add Modal -->
    <div id="bulk-add-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center mobile-container backdrop-blur-sm">
        <div class="parchment-bg rounded-2xl p-8 w-full max-w-md ancient-border transform animate-grow">
            <div class="text-center mb-6">
                <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-gold to-bronze rounded-2xl flex items-center justify-center ancient-border">
                    <i class="fas fa-users text-darkBrown text-3xl"></i>
                </div>
                <h4 class="text-2xl font-bold text-darkBrown font-maguntia">Tambah XP Massal</h4>
            </div>
            <div class="space-y-6">
                <div class="text-center">
                    <label class="block text-darkBrown font-semibold mb-3 font-medieval text-lg">Jumlah XP</label>
                    <div class="text-4xl font-bold text-gold gradient-text" id="bulk-points-amount">5</div>
                </div>
                <div class="text-center text-darkBrown font-medieval text-lg bg-oldPaper p-4 rounded-xl border-2 border-darkBrown">
                    <i class="fas fa-info-circle text-gold mr-2"></i>
                    XP akan ditambahkan ke semua petualang aktif
                </div>
                <div class="flex space-x-4">
                    <button onclick="addPointsToAllStudents()" class="flex-1 bg-gold hover:bg-yellow-600 text-darkBrown py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-darkBrown font-medieval text-lg shadow-lg hover:scale-105">
                        <i class="fas fa-bolt mr-2"></i>Tambah Semua
                    </button>
                    <button onclick="closeBulkAddModal()" class="flex-1 bg-deepRed hover:bg-red-800 text-parchment py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-gold font-medieval text-lg shadow-lg hover:scale-105">
                        <i class="fas fa-times mr-2"></i>Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class AdminSystem {
            constructor() {
                this.students = [];
                this.filteredStudents = [];
                this.selectedStudentId = null;
                this.bulkPoints = 0;
                this.searchTerm = '';
                this.selectedClass = '';
                this.selectedStatus = 'all';
                this.sortDescending = true;
                this.init();
            }

            init() {
                this.loadStudents();
                this.setupEventListeners();
                this.startAutoRefresh();
            }

            loadStudents() {
                const studentData = JSON.parse(localStorage.getItem('perpustakaan_abadi_students') || '[]');
                
                const updatedStudents = studentData.map(student => {
                    const lastActivity = new Date(student.lastActivity || student.lastLogin);
                    const now = new Date();
                    const minutesSinceLastActivity = (now - lastActivity) / (1000 * 60);
                    
                    student.isOnline = minutesSinceLastActivity < 5;
                    return student;
                });

                this.students = updatedStudents;
                this.applyFilters();
            }

            setupEventListeners() {
                document.getElementById('search-input').addEventListener('input', (e) => {
                    this.searchTerm = e.target.value.toLowerCase().trim();
                    this.applyFilters();
                });

                setInterval(() => {
                    this.loadStudents();
                }, 3000);
            }

            startAutoRefresh() {
                setInterval(() => {
                    this.loadStudents();
                }, 3000);
            }

            applyFilters() {
                let filtered = [...this.students];

                if (this.searchTerm) {
                    filtered = filtered.filter(student => 
                        student.name.toLowerCase().includes(this.searchTerm) ||
                        student.class.toLowerCase().includes(this.searchTerm)
                    );
                }

                if (this.selectedClass) {
                    filtered = filtered.filter(student => student.class === this.selectedClass);
                }

                if (this.selectedStatus !== 'all') {
                    filtered = filtered.filter(student => {
                        if (this.selectedStatus === 'online') return student.isOnline === true;
                        if (this.selectedStatus === 'offline') return student.isOnline === false;
                        return true;
                    });
                }

                filtered.sort((a, b) => {
                    return this.sortDescending ? b.points - a.points : a.points - b.points;
                });

                this.filteredStudents = filtered;
                this.updateDisplay();
            }

            updateDisplay() {
                this.updateStatistics();
                this.updateStudentsTable();
                this.updateSearchInfo();
            }

            updateStatistics() {
                const totalStudents = this.students.length;
                const onlineStudents = this.students.filter(s => s.isOnline).length;
                const totalPoints = this.students.reduce((sum, student) => sum + student.points, 0);
                const avgPoints = totalStudents > 0 ? Math.round(totalPoints / totalStudents) : 0;

                document.getElementById('total-students').textContent = totalStudents;
                document.getElementById('online-students').textContent = onlineStudents;
                document.getElementById('total-points').textContent = totalPoints.toLocaleString();
                document.getElementById('avg-points').textContent = avgPoints;
                document.getElementById('avg-points-display').textContent = avgPoints;

                // Update online progress
                const onlinePercent = totalStudents > 0 ? (onlineStudents / totalStudents) * 100 : 0;
                document.getElementById('online-progress').style.width = `${onlinePercent}%`;
            }

            updateStudentsTable() {
                const tbody = document.getElementById('students-table-body');
                const emptyState = document.getElementById('empty-state');
                const noResultsState = document.getElementById('no-results-state');
                const studentCount = document.getElementById('student-count');

                studentCount.innerHTML = `<i class="fas fa-users mr-2"></i><span>${this.filteredStudents.length} petualang</span>`;

                if (this.students.length === 0) {
                    tbody.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    noResultsState.classList.add('hidden');
                    return;
                }

                if (this.filteredStudents.length === 0) {
                    tbody.innerHTML = '';
                    emptyState.classList.add('hidden');
                    noResultsState.classList.remove('hidden');
                    return;
                }

                emptyState.classList.add('hidden');
                noResultsState.classList.add('hidden');

                tbody.innerHTML = this.filteredStudents.map(student => `
                    <tr class="student-row">
                        <td class="px-6 py-5">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-gradient-to-r from-gold to-bronze rounded-2xl flex items-center justify-center ancient-border text-darkBrown font-semibold">
                                    <i class="fas fa-${student.profileIcon || 'book-reader'} text-lg"></i>
                                </div>
                                <div>
                                    <div class="font-semibold text-darkBrown text-lg">
                                        ${this.highlightSearchTerm(student.name)}
                                    </div>
                                    <div class="text-darkBrown font-medieval text-sm opacity-70">ID: ${student.id.slice(-6)}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-5">
                            <span class="bg-gold/20 text-darkBrown px-4 py-2 rounded-xl text-base font-semibold font-medieval border-2 border-darkBrown">
                                ${student.class}
                            </span>
                        </td>
                        <td class="px-6 py-5">
                            <div class="flex flex-col space-y-3">
                                <span class="font-bold text-darkBrown text-xl">${student.points.toLocaleString()}</span>
                                <div class="w-32 bg-darkBrown rounded-full h-3">
                                    <div class="rank-progress h-3 rounded-full transition-all duration-1000" 
                                         style="width: ${Math.min(100, (student.points / 1000) * 100)}%"></div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-5">
                            <span class="px-4 py-2 rounded-xl text-base font-semibold border-2 border-darkBrown ${
                                this.getRankColor(student.points)
                            } font-medieval">
                                ${this.getShortRankName(student.points)}
                            </span>
                        </td>
                        <td class="px-6 py-5">
                            <span class="px-4 py-2 rounded-xl text-base font-semibold border-2 border-darkBrown ${
                                student.isOnline ? 'bg-forestGreen/20 text-forestGreen' : 'bg-deepRed/20 text-deepRed'
                            } font-medieval flex items-center">
                                <span class="online-status ${student.isOnline ? 'status-online' : 'status-offline'}"></span>
                                ${student.isOnline ? 'Online' : 'Offline'}
                            </span>
                        </td>
                        <td class="px-6 py-5">
                            <div class="flex flex-col space-y-2">
                                <button onclick="adminSystem.showAddPointsModal('${student.id}')" 
                                        class="bg-gold hover:bg-yellow-600 text-darkBrown px-4 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 border-2 border-darkBrown font-medieval text-base flex items-center justify-center action-btn">
                                    <i class="fas fa-plus mr-2"></i>Tambah XP
                                </button>
                                <button onclick="adminSystem.resetStudent('${student.id}')" 
                                        class="bg-deepRed hover:bg-red-800 text-parchment px-4 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 border-2 border-gold font-medieval text-base flex items-center justify-center action-btn">
                                    <i class="fas fa-redo mr-2"></i>Reset
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            updateSearchInfo() {
                const searchInfo = document.getElementById('search-info');
                const resultCount = document.getElementById('result-count');
                const totalCount = document.getElementById('total-count');
                const searchTermDisplay = document.getElementById('search-term-display');

                if (this.searchTerm || this.selectedClass || this.selectedStatus !== 'all') {
                    resultCount.textContent = this.filteredStudents.length;
                    totalCount.textContent = this.students.length;
                    
                    let displayText = '';
                    if (this.searchTerm) {
                        displayText += ` untuk "${this.searchTerm}"`;
                    }
                    if (this.selectedClass) {
                        displayText += ` di ${this.selectedClass}`;
                    }
                    if (this.selectedStatus !== 'all') {
                        displayText += ` (${this.selectedStatus})`;
                    }
                    
                    searchTermDisplay.textContent = displayText;
                    searchInfo.classList.remove('hidden');
                } else {
                    searchInfo.classList.add('hidden');
                }
            }

            highlightSearchTerm(text) {
                if (!this.searchTerm) return text;
                const regex = new RegExp(`(${this.searchTerm})`, 'gi');
                return text.replace(regex, '<span class="search-highlight">$1</span>');
            }

            clearSearch() {
                document.getElementById('search-input').value = '';
                this.searchTerm = '';
                this.selectedClass = '';
                this.selectedStatus = 'all';
                this.updateFilterButtons();
                this.applyFilters();
            }

            filterByClass(className) {
                this.selectedClass = className;
                this.updateFilterButtons();
                this.applyFilters();
            }

            filterByStatus(status) {
                this.selectedStatus = status;
                this.updateFilterButtons();
                this.applyFilters();
            }

            updateFilterButtons() {
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                if (this.selectedClass === '') {
                    document.querySelector('.filter-btn:first-child').classList.add('active');
                } else {
                    const classButtons = document.querySelectorAll(`[onclick*="${this.selectedClass}"]`);
                    classButtons.forEach(btn => btn.classList.add('active'));
                }

                const statusButtons = document.querySelectorAll('[onclick*="filterByStatus"]');
                statusButtons.forEach(btn => {
                    if (btn.onclick.toString().includes(this.selectedStatus)) {
                        btn.classList.add('active');
                    }
                });
            }

            toggleSort() {
                this.sortDescending = !this.sortDescending;
                const sortIcon = document.getElementById('sort-icon');
                const sortText = document.getElementById('sort-text');
                
                if (this.sortDescending) {
                    sortIcon.className = 'fas fa-sort-amount-down mr-2';
                    sortText.textContent = 'XP Tertinggi';
                } else {
                    sortIcon.className = 'fas fa-sort-amount-up mr-2';
                    sortText.textContent = 'XP Terendah';
                }
                
                this.applyFilters();
            }

            showAddPointsModal(studentId) {
                this.selectedStudentId = studentId;
                document.getElementById('points-amount').value = 5;
                document.getElementById('add-points-modal').classList.remove('hidden');
            }

            addPointsToStudent() {
                if (!this.selectedStudentId) {
                    this.showNotification('Tidak ada siswa yang dipilih', 'error');
                    return;
                }

                const points = parseInt(document.getElementById('points-amount').value) || 5;
                const studentIndex = this.students.findIndex(s => s.id === this.selectedStudentId);
                
                if (studentIndex === -1) {
                    this.showNotification('Siswa tidak ditemukan', 'error');
                    return;
                }

                this.students[studentIndex].points += points;
                this.students[studentIndex].lastActivity = new Date().toISOString();

                this.saveChanges();
                this.closeAddPointsModal();
                
                const studentName = this.students[studentIndex].name;
                this.showNotification(`+${points} XP berhasil ditambahkan ke ${studentName}`, 'success');
            }

            showBulkAddModal(points) {
                this.bulkPoints = points;
                document.getElementById('bulk-points-amount').textContent = points;
                document.getElementById('bulk-add-modal').classList.remove('hidden');
            }

            addPointsToAllStudents() {
                const points = this.bulkPoints;
                
                this.students.forEach((student, index) => {
                    this.students[index].points += points;
                    this.students[index].lastActivity = new Date().toISOString();
                });

                this.saveChanges();
                this.closeBulkAddModal();
                this.showNotification(`+${points} XP ke semua petualang`, 'success');
            }

            resetStudent(studentId) {
                if (confirm('Reset XP petualang ini? Semua progress akan hilang.')) {
                    const studentIndex = this.students.findIndex(s => s.id === studentId);
                    if (studentIndex !== -1) {
                        this.students[studentIndex].points = 0;
                        this.students[studentIndex].level = 0;
                        this.students[studentIndex].lastActivity = new Date().toISOString();
                        this.saveChanges();
                        this.showNotification(`XP ${this.students[studentIndex].name} direset`, 'info');
                    }
                }
            }

            saveChanges() {
                localStorage.setItem('perpustakaan_abadi_students', JSON.stringify(this.students));
                this.applyFilters();
            }

            closeAddPointsModal() {
                document.getElementById('add-points-modal').classList.add('hidden');
                this.selectedStudentId = null;
            }

            closeBulkAddModal() {
                document.getElementById('bulk-add-modal').classList.add('hidden');
                this.bulkPoints = 0;
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `fixed top-6 right-6 z-50 px-6 py-4 rounded-2xl font-semibold text-white transition-all duration-300 transform translate-x-full border-2 ${
                    type === 'error' ? 'bg-deepRed border-red-300' : 
                    type === 'success' ? 'bg-forestGreen border-green-300' : 'bg-mysticBlue border-blue-300'
                } font-medieval text-lg max-w-sm shadow-2xl`;
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => notification.style.transform = 'translateX(0)', 100);

                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => notification.remove(), 300);
                }, 4000);
            }

            getRankName(points) {
                if (points >= 1000) return '📕 Penguasa Cerita';
                if (points >= 800) return '📗 Ahli Tinta';
                if (points >= 600) return '📘 Penjaga Buku';
                if (points >= 300) return '📜 Pencari Aksara';
                if (points >= 100) return '📚 Penjelajah Halaman';
                return '📖 Pemula Naskah';
            }

            getShortRankName(points) {
                if (points >= 1000) return '🏆 Master';
                if (points >= 800) return '📗 Expert';
                if (points >= 600) return '📘 Advanced';
                if (points >= 300) return '📜 Intermediate';
                if (points >= 100) return '📚 Beginner';
                return '📖 Newbie';
            }

            getRankColor(points) {
                if (points >= 1000) return 'bg-gradient-to-r from-red-500 to-yellow-500 text-white';
                if (points >= 800) return 'bg-gradient-to-r from-indigo-500 to-purple-500 text-white';
                if (points >= 600) return 'bg-gradient-to-r from-purple-500 to-blue-500 text-white';
                if (points >= 300) return 'bg-gradient-to-r from-blue-500 to-green-500 text-white';
                if (points >= 100) return 'bg-gradient-to-r from-green-500 to-emerald-500 text-white';
                return 'bg-gradient-to-r from-gray-400 to-gray-600 text-white';
            }
        }

        // Global functions
        function showBulkAddModal(points) {
            adminSystem.showBulkAddModal(points);
        }

        function closeAddPointsModal() {
            adminSystem.closeAddPointsModal();
        }

        function closeBulkAddModal() {
            adminSystem.closeBulkAddModal();
        }

        function addPointsToStudent() {
            adminSystem.addPointsToStudent();
        }

        function addPointsToAllStudents() {
            adminSystem.addPointsToAllStudents();
        }

        function refreshData() {
            adminSystem.loadStudents();
            adminSystem.showNotification('Data berhasil diperbarui', 'success');
        }

        // Initialize admin system
        const adminSystem = new AdminSystem();
    </script>
</body>
</html>
