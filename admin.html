<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perpustakaan Abadi - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=MedievalSharp&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        parchment: '#F5E6CA',
                        oldPaper: '#E8D9B5',
                        darkBrown: '#8B4513',
                        gold: '#D4AF37',
                        silver: '#C0C0C0',
                        bronze: '#CD7F32',
                        mysticBlue: '#1E3A5F',
                        deepRed: '#8B0000',
                        forestGreen: '#228B22',
                        lightBrown: '#A0522D',
                        black: '#000000'
                    },
                    fontFamily: {
                        'cinzel': ['Cinzel', 'serif'],
                        'medieval': ['MedievalSharp', 'cursive'],
                        'maguntia': ['UnifrakturMaguntia', 'cursive']
                    },
                    spacing: {
                        '18': '4.5rem',
                        '88': '22rem',
                        '128': '32rem'
                    }
                }
            }
        }
    </script>
    <style>
        /* KEEP ALL YOUR EXISTING CSS STYLES */
        body {
            background: linear-gradient(135deg, #2C1810 0%, #1A0F0A 50%, #0F0805 100%);
            min-height: 100vh;
        }
        
        .parchment-bg {
            background: linear-gradient(135deg, #F5E6CA 0%, #E8D9B5 50%, #DBC9A0 100%);
            border: 3px double #8B4513;
            box-shadow: 
                0 4px 20px rgba(139, 69, 19, 0.15),
                inset 0 0 30px rgba(139, 69, 19, 0.08);
        }
        
        .ancient-border {
            border: 2px solid transparent;
            border-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,0 L100,0 L100,100 L0,100 Z' fill='none' stroke='%238B4513' stroke-width='4' stroke-dasharray='12,6'/%3E%3C/svg%3E") 20 round;
        }
        
        .stats-card {
            transition: all 0.3s ease;
            border: 2px solid #8B4513;
            backdrop-filter: blur(10px);
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(139, 69, 19, 0.2);
        }
        
        .student-row {
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(139, 69, 19, 0.2);
        }
        
        .student-row:hover {
            background: linear-gradient(90deg, rgba(212, 175, 55, 0.08), rgba(139, 69, 19, 0.05));
            transform: translateX(4px);
        }
        
        .rank-progress {
            background: linear-gradient(90deg, #D4AF37, #8B4513);
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
        }

        /* Text Colors - FIXED to Black */
        .text-dark {
            color: #000000 !important;
        }
        
        .text-darker {
            color: #1a1a1a !important;
        }

        /* Mobile First Design */
        .mobile-container {
            padding-left: 1rem;
            padding-right: 1rem;
        }
        
        @media (min-width: 768px) {
            .mobile-container {
                padding-left: 2rem;
                padding-right: 2rem;
            }
        }

        /* Custom scrollbar */
        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: #8B4513 #F5E6CA;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #F5E6CA;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #8B4513;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #A0522D;
        }

        /* Search highlight */
        .search-highlight {
            background-color: rgba(212, 175, 55, 0.4);
            border-radius: 3px;
            padding: 0 3px;
            font-weight: 600;
            color: #000000 !important;
        }

        /* Filter buttons */
        .filter-btn {
            transition: all 0.3s ease;
            border: 2px solid #8B4513;
            color: #000000 !important;
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.2);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #D4AF37, #8B4513);
            color: white !important;
            border-color: #8B4513;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
        }

        /* Online/Offline Status */
        .online-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 6px;
            box-shadow: 0 0 5px currentColor;
        }
        
        .status-online {
            background-color: #22c55e;
        }
        
        .status-offline {
            background-color: #ef4444;
        }

        /* Action buttons */
        .action-btn {
            transition: all 0.2s ease;
            border: 1.5px solid;
        }

        .action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Loading animation */
        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
            }
            50% { 
                box-shadow: 0 0 30px rgba(212, 175, 55, 0.6);
            }
        }

        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        /* Card hover effects */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(139, 69, 19, 0.15);
        }

        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, #D4AF37 0%, #8B4513 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Password field */
        .password-field {
            font-family: monospace;
            letter-spacing: 1px;
        }

        .copy-password {
            transition: all 0.3s ease;
        }

        .copy-password:hover {
            transform: scale(1.1);
            color: #D4AF37;
        }

        /* Admin Authentication */
        .admin-auth-modal {
            backdrop-filter: blur(10px);
        }

        /* Export buttons */
        .export-btn {
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        /* PERBAIKAN: Tampilan Rank yang Tidak Terpotong */
        .rank-display {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            max-width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .rank-text {
            font-size: 0.875rem;
            font-weight: 600;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 150px;
        }

        @media (min-width: 768px) {
            .rank-text {
                font-size: 1rem;
                max-width: 180px;
            }
        }

        .table-rank {
            font-size: 0.875rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 140px;
            display: inline-block;
        }

        @media (min-width: 1024px) {
            .table-rank {
                font-size: 1rem;
                max-width: 160px;
            }
        }
        
        /* NEW: Real-time sync indicator */
        .sync-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .sync-active {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #22c55e;
            color: #22c55e;
        }
        
        .sync-inactive {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #ef4444;
        }
    </style>
</head>
<body class="font-cinzel text-black min-h-screen">
    <!-- Sync Indicator -->
    <div id="sync-indicator" class="sync-indicator sync-active hidden">
        <i class="fas fa-sync-alt mr-1"></i>
        <span>Real-time Sync</span>
    </div>

    <!-- Admin Authentication Modal -->
    <div id="admin-auth-modal" class="fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4 admin-auth-modal">
        <div class="parchment-bg rounded-2xl p-8 max-w-md w-full transform animate-grow ancient-border">
            <div class="text-center mb-6">
                <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-gold to-bronze rounded-2xl flex items-center justify-center ancient-border pulse-glow">
                    <i class="fas fa-user-shield text-darkBrown text-3xl"></i>
                </div>
                <h2 class="text-2xl md:text-3xl font-bold text-dark font-maguntia mb-2">Admin Panel</h2>
                <p class="text-dark font-medieval text-sm">Akses terbatas untuk administrator</p>
            </div>

            <form id="admin-login-form" class="space-y-6">
                <div>
                    <label class="block text-dark font-semibold mb-3 font-medieval text-lg">Username Admin</label>
                    <input type="text" id="admin-username" required 
                           class="w-full px-6 py-4 bg-oldPaper border-3 border-darkBrown rounded-2xl focus:border-gold focus:ring-4 focus:ring-gold/20 transition-all duration-300 outline-none font-medieval text-lg text-dark"
                           placeholder="Masukkan username admin">
                </div>
                <div class="relative">
                    <label class="block text-dark font-semibold mb-3 font-medieval text-lg">Password Admin</label>
                    <input type="password" id="admin-password" required 
                           class="w-full px-6 py-4 bg-oldPaper border-3 border-darkBrown rounded-2xl focus:border-gold focus:ring-4 focus:ring-gold/20 transition-all duration-300 outline-none font-medieval text-lg text-dark pr-12"
                           placeholder="Masukkan password admin">
                    <div class="absolute right-4 top-11 transform -translate-y-1/2 password-toggle" onclick="togglePassword('admin-password')">
                        <i class="fas fa-eye text-darkBrown text-xl"></i>
                    </div>
                </div>

                <button type="submit" class="w-full bg-gradient-to-r from-gold to-bronze text-darkBrown py-4 rounded-2xl font-bold text-lg transition-all duration-300 transform hover:scale-105 hover:shadow-lg border-3 border-darkBrown font-medieval">
                    <i class="fas fa-key mr-3"></i>Masuk sebagai Admin
                </button>
            </form>

            <div class="mt-6 p-4 bg-oldPaper rounded-xl border-2 border-darkBrown text-center">
                <p class="text-dark font-medieval text-sm">
                    <strong>Default Credentials:</strong><br>
                    Username: <code class="bg-darkBrown text-parchment px-2 py-1 rounded">admin</code><br>
                    Password: <code class="bg-darkBrown text-parchment px-2 py-1 rounded">admin123</code>
                </p>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav id="admin-nav" class="hidden bg-darkBrown/95 backdrop-blur-md shadow-2xl border-b-2 border-gold sticky top-0 z-50">
        <div class="mobile-container">
            <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center space-y-4 lg:space-y-0 py-4">
                <!-- Logo & Title -->
                <div class="flex items-center space-x-4 justify-center lg:justify-start">
                    <div class="w-12 h-12 bg-gradient-to-r from-gold to-bronze rounded-2xl flex items-center justify-center ancient-border pulse-glow">
                        <i class="fas fa-user-shield text-darkBrown text-xl"></i>
                    </div>
                    <div class="text-center lg:text-left">
                        <h1 class="text-2xl lg:text-3xl font-bold text-gold font-maguntia">Perpustakaan Abadi</h1>
                        <p class="text-silver text-sm lg:text-base font-medieval mt-1">Panel Administrator</p>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-3 justify-center lg:justify-end">
                    <button onclick="adminSystem.exportAllData()" class="bg-forestGreen hover:bg-green-800 text-parchment px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 border-2 border-gold font-medieval text-sm lg:text-base flex items-center justify-center shadow-lg export-btn">
                        <i class="fas fa-download mr-3"></i>Export Data
                    </button>
                    <button onclick="adminSystem.showBackupModal()" class="bg-mysticBlue hover:bg-blue-800 text-parchment px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 border-2 border-gold font-medieval text-sm lg:text-base flex items-center justify-center shadow-lg">
                        <i class="fas fa-database mr-3"></i>Backup
                    </button>
                    <button onclick="adminSystem.refreshData()" class="bg-gold hover:bg-yellow-600 text-darkBrown px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 border-2 border-darkBrown font-medieval text-sm lg:text-base flex items-center justify-center shadow-lg">
                        <i class="fas fa-sync-alt mr-3"></i>Refresh Data
                    </button>
                    <a href="siswa.html" class="bg-deepRed hover:bg-red-800 text-parchment px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 border-2 border-gold font-medieval text-sm lg:text-base flex items-center justify-center shadow-lg">
                        <i class="fas fa-eye mr-3"></i>View Students
                    </a>
                    <button onclick="adminSystem.logout()" class="bg-darkBrown hover:bg-black text-parchment px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 border-2 border-gold font-medieval text-sm lg:text-base flex items-center justify-center shadow-lg">
                        <i class="fas fa-sign-out-alt mr-3"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="admin-main" class="hidden py-6 lg:py-8">
        <div class="mobile-container max-w-7xl mx-auto">
            <!-- Statistics Overview -->
            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
                <div class="stats-card parchment-bg rounded-2xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div class="space-y-2">
                            <div class="text-3xl lg:text-4xl font-bold text-dark" id="total-students">0</div>
                            <div class="text-dark font-medieval text-lg">Total Adventurers</div>
                        </div>
                        <div class="w-14 h-14 bg-gold/20 rounded-2xl flex items-center justify-center ancient-border">
                            <i class="fas fa-users text-gold text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 w-full bg-oldPaper rounded-full h-2">
                        <div class="bg-gradient-to-r from-gold to-bronze h-2 rounded-full transition-all duration-1000" style="width: 100%"></div>
                    </div>
                </div>

                <div class="stats-card parchment-bg rounded-2xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div class="space-y-2">
                            <div class="text-3xl lg:text-4xl font-bold text-dark" id="online-students">0</div>
                            <div class="text-dark font-medieval text-lg">Currently Online</div>
                        </div>
                        <div class="w-14 h-14 bg-forestGreen/20 rounded-2xl flex items-center justify-center ancient-border">
                            <i class="fas fa-wifi text-forestGreen text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 w-full bg-oldPaper rounded-full h-2">
                        <div class="bg-gradient-to-r from-forestGreen to-green-600 h-2 rounded-full transition-all duration-1000" id="online-progress" style="width: 0%"></div>
                    </div>
                </div>

                <div class="stats-card parchment-bg rounded-2xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div class="space-y-2">
                            <div class="text-3xl lg:text-4xl font-bold text-dark" id="total-points">0</div>
                            <div class="text-dark font-medieval text-lg">Total XP</div>
                        </div>
                        <div class="w-14 h-14 bg-gold/20 rounded-2xl flex items-center justify-center ancient-border">
                            <i class="fas fa-star text-gold text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-dark font-medieval">
                        ‚≠ê Average: <span id="avg-points-display">0</span> XP
                    </div>
                </div>

                <div class="stats-card parchment-bg rounded-2xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div class="space-y-2">
                            <div class="text-3xl lg:text-4xl font-bold text-dark" id="avg-points">0</div>
                            <div class="text-dark font-medieval text-lg">Average XP</div>
                        </div>
                        <div class="w-14 h-14 bg-bronze/20 rounded-2xl flex items-center justify-center ancient-border">
                            <i class="fas fa-chart-line text-bronze text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-dark font-medieval">
                        üìà System Progress
                    </div>
                </div>
            </div>

            <!-- Search and Filter Section -->
            <div class="parchment-bg rounded-2xl p-6 lg:p-8 ancient-border mb-8">
                <!-- Search Bar -->
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0 mb-6">
                    <div class="flex-1">
                        <div class="relative">
                            <input 
                                type="text" 
                                id="search-input"
                                placeholder="Search adventurer name or class..."
                                class="w-full px-6 py-4 bg-oldPaper border-3 border-darkBrown rounded-2xl focus:border-gold focus:ring-4 focus:ring-gold/20 transition-all duration-300 outline-none font-medieval text-lg placeholder-black/60 shadow-inner text-dark"
                            >
                            <div class="absolute right-4 top-1/2 transform -translate-y-1/2 text-darkBrown text-xl">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="adminSystem.clearSearch()" class="bg-silver hover:bg-gray-500 text-darkBrown px-6 py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-darkBrown font-medieval text-base flex items-center justify-center action-btn">
                            <i class="fas fa-times mr-2"></i>Clear
                        </button>
                        <button onclick="adminSystem.toggleSort()" class="bg-mysticBlue hover:bg-blue-800 text-parchment px-6 py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-gold font-medieval text-base flex items-center justify-center action-btn">
                            <i class="fas fa-sort-amount-down mr-2" id="sort-icon"></i>
                            <span id="sort-text">Highest XP</span>
                        </button>
                    </div>
                </div>

                <!-- Filter by Class -->
                <div class="mb-6">
                    <h3 class="text-dark font-semibold font-medieval text-lg mb-4">Filter Class:</h3>
                    <div class="grid grid-cols-3 sm:grid-cols-4 lg:grid-cols-8 gap-3">
                        <button onclick="adminSystem.filterByClass('')" class="filter-btn active bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            All
                        </button>
                        <button onclick="adminSystem.filterByClass('X1')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X1
                        </button>
                        <button onclick="adminSystem.filterByClass('X2')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X2
                        </button>
                        <button onclick="adminSystem.filterByClass('X3')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X3
                        </button>
                        <button onclick="adminSystem.filterByClass('X4')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X4
                        </button>
                        <button onclick="adminSystem.filterByClass('X5')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X5
                        </button>
                        <button onclick="adminSystem.filterByClass('X6')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X6
                        </button>
                        <button onclick="adminSystem.filterByClass('X7')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X7
                        </button>
                        <button onclick="adminSystem.filterByClass('X8')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X8
                        </button>
                        <button onclick="adminSystem.filterByClass('X9')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X9
                        </button>
                        <button onclick="adminSystem.filterByClass('XI MIPA 1')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI MIPA 1
                        </button>
                        <button onclick="adminSystem.filterByClass('XI MIPA 2')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI MIPA 2
                        </button>
                        <button onclick="adminSystem.filterByClass('XI MIPA 3')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI MIPA 3
                        </button>
                        <button onclick="adminSystem.filterByClass('XI MIPA 4')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI MIPA 4
                        </button>
                        <button onclick="adminSystem.filterByClass('XI MIPA 5')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI MIPA 5
                        </button>
                        <button onclick="adminSystem.filterByClass('XI IPS 1')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI IPS 1
                        </button>
                        <button onclick="adminSystem.filterByClass('XI IPS 2')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI IPS 2
                        </button>
                        <button onclick="adminSystem.filterByClass('XI IPS 3')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI IPS 3
                        </button>
                        <button onclick="adminSystem.filterByClass('XI IPS 4')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI IPS 4
                        </button>
                        <button onclick="adminSystem.filterByClass('XII MIPA 1')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII MIPA 1
                        </button>
                        <button onclick="adminSystem.filterByClass('XII MIPA 2')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII MIPA 2
                        </button>
                        <button onclick="adminSystem.filterByClass('XII MIPA 3')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII MIPA 3
                        </button>
                        <button onclick="adminSystem.filterByClass('XII MIPA 4')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII MIPA 4
                        </button>
                        <button onclick="adminSystem.filterByClass('XII MIPA 5')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII MIPA 5
                        </button>
                        <button onclick="adminSystem.filterByClass('XII IPS 1')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII IPS 1
                        </button>
                        <button onclick="adminSystem.filterByClass('XII IPS 2')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII IPS 2
                        </button>
                        <button onclick="adminSystem.filterByClass('XII IPS 3')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII IPS 3
                        </button>
                        <button onclick="adminSystem.filterByClass('XII BAHASA')" class="filter-btn bg-gold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII BAHASA
                        </button>
                    </div>
                </div>

                <!-- Status Filter -->
                <div class="mb-4">
                    <h3 class="text-dark font-semibold font-medieval text-lg mb-4">Filter Status:</h3>
                    <div class="flex flex-wrap gap-3">
                        <button onclick="adminSystem.filterByStatus('all')" class="filter-btn active bg-gold/20 px-6 py-3 rounded-xl text-base font-semibold font-medieval">
                            All Status
                        </button>
                        <button onclick="adminSystem.filterByStatus('online')" class="filter-btn bg-gold/20 px-6 py-3 rounded-xl text-base font-semibold font-medieval">
                            <span class="online-status status-online"></span>Online
                        </button>
                        <button onclick="adminSystem.filterByStatus('offline')" class="filter-btn bg-gold/20 px-6 py-3 rounded-xl text-base font-semibold font-medieval">
                            <span class="online-status status-offline"></span>Offline
                        </button>
                    </div>
                </div>

                <!-- Search Results Info -->
                <div id="search-info" class="mt-4 p-4 bg-oldPaper rounded-xl border-2 border-darkBrown text-dark font-medieval text-base hidden">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-info-circle text-gold"></i>
                        <span>Showing <span class="font-bold text-dark" id="result-count">0</span> of <span class="font-bold text-dark" id="total-count">0</span> adventurers</span>
                        <span id="search-term-display" class="font-semibold text-gold"></span>
                    </div>
                </div>
            </div>

            <!-- Students List Section -->
            <div class="parchment-bg rounded-2xl overflow-hidden ancient-border mb-8">
                <!-- Header -->
                <div class="px-6 lg:px-8 py-6 border-b-2 border-darkBrown bg-gradient-to-r from-oldPaper to-parchment">
                    <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center space-y-4 lg:space-y-0">
                        <div>
                            <h3 class="text-2xl lg:text-3xl font-bold text-dark font-maguntia mb-2">Adventurers List</h3>
                            <p class="text-dark font-medieval text-lg">Manage XP and monitor literacy progress</p>
                        </div>
                        <div id="student-count" class="bg-gold/30 text-darkBrown px-6 py-3 rounded-xl text-base font-semibold border-2 border-darkBrown font-medieval">
                            <i class="fas fa-users mr-2"></i>
                            <span>0 adventurers</span>
                        </div>
                    </div>
                </div>

                <!-- Table Container -->
                <div class="overflow-x-auto custom-scrollbar">
                    <table class="w-full min-w-[1000px] lg:min-w-full">
                        <thead>
                            <tr class="bg-gradient-to-r from-oldPaper to-parchment">
                                <th class="px-6 py-5 text-left font-bold text-dark font-medieval text-lg border-b-2 border-darkBrown">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-user text-gold"></i>
                                        <span>Adventurer Name</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-dark font-medieval text-lg border-b-2 border-darkBrown">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-graduation-cap text-gold"></i>
                                        <span>Class</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-dark font-medieval text-lg border-b-2 border-darkBrown">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-key text-gold"></i>
                                        <span>Password</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-dark font-medieval text-lg border-b-2 border-darkBrown">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-star text-gold"></i>
                                        <span>XP</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-dark font-medieval text-lg border-b-2 border-darkBrown">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-trophy text-gold"></i>
                                        <span>Rank</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-dark font-medieval text-lg border-b-2 border-darkBrown">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-signal text-gold"></i>
                                        <span>Status</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-dark font-medieval text-lg border-b-2 border-darkBrown">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-cogs text-gold"></i>
                                        <span>Actions</span>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="students-table-body" class="table-responsive">
                            <!-- Data siswa akan diisi di sini -->
                        </tbody>
                    </table>
                </div>

                <!-- Empty States -->
                <div class="mobile-text-center mobile-full-width">
                    <div class="mobile-px-4 mobile-py-16 border-t-2 border-darkBrown text-center text-dark font-medieval" id="empty-state">
                        <i class="fas fa-scroll text-6xl mb-6 opacity-40"></i>
                        <p class="text-2xl mb-3">No adventurers yet</p>
                        <p class="text-lg opacity-80">Direct students to login to the system</p>
                    </div>

                    <div class="mobile-px-4 mobile-py-16 border-t-2 border-darkBrown text-center text-dark font-medieval hidden" id="no-results-state">
                        <i class="fas fa-search text-6xl mb-6 opacity-40"></i>
                        <p class="text-2xl mb-3">No results found</p>
                        <p class="text-lg opacity-80">Try different keywords or filters</p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions Section -->
            <div class="parchment-bg rounded-2xl p-6 lg:p-8 ancient-border">
                <h3 class="text-2xl lg:text-3xl font-bold text-dark font-maguntia mb-6">Quick XP Actions</h3>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6">
                    <button onclick="adminSystem.showBulkAddModal(5)" class="parchment-bg hover:bg-gold/30 text-dark py-6 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 border-3 border-darkBrown font-medieval text-lg flex flex-col items-center justify-center action-btn shadow-lg">
                        <i class="fas fa-plus-circle text-3xl mb-3 text-gold"></i>
                        <span>+5 XP</span>
                        <span class="text-sm opacity-70 mt-1">Small Add</span>
                    </button>
                    <button onclick="adminSystem.showBulkAddModal(15)" class="parchment-bg hover:bg-gold/30 text-dark py-6 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 border-3 border-darkBrown font-medieval text-lg flex flex-col items-center justify-center action-btn shadow-lg">
                        <i class="fas fa-plus-circle text-3xl mb-3 text-bronze"></i>
                        <span>+15 XP</span>
                        <span class="text-sm opacity-70 mt-1">Medium Add</span>
                    </button>
                    <button onclick="adminSystem.showBulkAddModal(20)" class="parchment-bg hover:bg-gold/30 text-dark py-6 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 border-3 border-darkBrown font-medieval text-lg flex flex-col items-center justify-center action-btn shadow-lg">
                        <i class="fas fa-plus-circle text-3xl mb-3 text-gold"></i>
                        <span>+20 XP</span>
                        <span class="text-sm opacity-70 mt-1">Large Add</span>
                    </button>
                    <button onclick="adminSystem.showBulkAddModal(30)" class="parchment-bg hover:bg-gold/30 text-dark py-6 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 border-3 border-darkBrown font-medieval text-lg flex flex-col items-center justify-center action-btn shadow-lg">
                        <i class="fas fa-plus-circle text-3xl mb-3 text-bronze"></i>
                        <span>+30 XP</span>
                        <span class="text-sm opacity-70 mt-1">Maximum Add</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Points Modal -->
    <div id="add-points-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center mobile-container backdrop-blur-sm">
        <div class="parchment-bg rounded-2xl p-8 w-full max-w-md ancient-border transform animate-grow">
            <div class="text-center mb-6">
                <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-gold to-bronze rounded-2xl flex items-center justify-center ancient-border">
                    <i class="fas fa-plus text-darkBrown text-3xl"></i>
                </div>
                <h4 class="text-2xl font-bold text-dark font-maguntia">Add XP</h4>
            </div>
            <div class="space-y-6">
                <div>
                    <label class="block text-dark font-semibold mb-3 font-medieval text-lg">XP Amount</label>
                    <input type="number" id="points-amount" 
                           class="w-full px-6 py-4 bg-oldPaper border-3 border-darkBrown rounded-2xl focus:border-gold focus:ring-4 focus:ring-gold/20 transition-all duration-300 outline-none font-medieval text-lg text-center text-dark"
                           min="1" max="100" value="5">
                </div>
                <div class="flex space-x-4">
                    <button onclick="adminSystem.addPointsToStudent()" class="flex-1 bg-gold hover:bg-yellow-600 text-darkBrown py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-darkBrown font-medieval text-lg shadow-lg hover:scale-105">
                        <i class="fas fa-check mr-2"></i>Add XP
                    </button>
                    <button onclick="adminSystem.closeAddPointsModal()" class="flex-1 bg-deepRed hover:bg-red-800 text-parchment py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-gold font-medieval text-lg shadow-lg hover:scale-105">
                        <i class="fas fa-times mr-2"></i>Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Add Modal -->
    <div id="bulk-add-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center mobile-container backdrop-blur-sm">
        <div class="parchment-bg rounded-2xl p-8 w-full max-w-md ancient-border transform animate-grow">
            <div class="text-center mb-6">
                <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-gold to-bronze rounded-2xl flex items-center justify-center ancient-border">
                    <i class="fas fa-users text-darkBrown text-3xl"></i>
                </div>
                <h4 class="text-2xl font-bold text-dark font-maguntia">Bulk Add XP</h4>
            </div>
            <div class="space-y-6">
                <div class="text-center">
                    <label class="block text-dark font-semibold mb-3 font-medieval text-lg">XP Amount</label>
                    <div class="text-4xl font-bold text-gold gradient-text" id="bulk-points-amount">5</div>
                </div>
                <div class="text-center text-dark font-medieval text-lg bg-oldPaper p-4 rounded-xl border-2 border-darkBrown">
                    <i class="fas fa-info-circle text-gold mr-2"></i>
                    XP will be added to all active adventurers
                </div>
                <div class="flex space-x-4">
                    <button onclick="adminSystem.addPointsToAllStudents()" class="flex-1 bg-gold hover:bg-yellow-600 text-darkBrown py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-darkBrown font-medieval text-lg shadow-lg hover:scale-105">
                        <i class="fas fa-bolt mr-2"></i>Add to All
                    </button>
                    <button onclick="adminSystem.closeBulkAddModal()" class="flex-1 bg-deepRed hover:bg-red-800 text-parchment py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-gold font-medieval text-lg shadow-lg hover:scale-105">
                        <i class="fas fa-times mr-2"></i>Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Backup Modal -->
    <div id="backup-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center mobile-container backdrop-blur-sm">
        <div class="parchment-bg rounded-2xl p-8 w-full max-w-2xl ancient-border transform animate-grow">
            <div class="text-center mb-6">
                <h4 class="text-2xl font-bold text-dark font-maguntia">Backup Management</h4>
                <p class="text-dark font-medieval">Backup and restore system data</p>
            </div>
            <div class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <button onclick="adminSystem.createBackup()" class="parchment-bg hover:bg-gold/30 text-dark py-6 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 border-3 border-darkBrown font-medieval text-lg flex flex-col items-center justify-center action-btn">
                        <i class="fas fa-save text-3xl mb-3 text-gold"></i>
                        <span>Create Backup</span>
                    </button>
                    <button onclick="adminSystem.exportBackup()" class="parchment-bg hover:bg-gold/30 text-dark py-6 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 border-3 border-darkBrown font-medieval text-lg flex flex-col items-center justify-center action-btn">
                        <i class="fas fa-download text-3xl mb-3 text-bronze"></i>
                        <span>Export Backup</span>
                    </button>
                </div>
                <div class="text-center">
                    <button onclick="adminSystem.closeBackupModal()" class="bg-deepRed hover:bg-red-800 text-parchment px-6 py-3 rounded-2xl font-semibold transition-all duration-300 border-3 border-gold font-medieval">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Admin System - TERHUBUNG DENGAN DATA SISWA
        class AdminSystem {
            constructor() {
                this.students = [];
                this.filteredStudents = [];
                this.selectedStudentId = null;
                this.bulkPoints = 0;
                this.searchTerm = '';
                this.selectedClass = '';
                this.selectedStatus = 'all';
                this.sortDescending = true;
                this.isAuthenticated = false;
                this.adminCredentials = {
                    username: 'admin',
                    password: 'admin123'
                };
                this.dataKey = 'pohon_students'; // KEY YANG SAMA DENGAN SISWA
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.checkAdminSession();
                this.showSyncIndicator();
            }

            setupEventListeners() {
                // Admin login form
                document.getElementById('admin-login-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleAdminLogin();
                });

                // Search input
                document.getElementById('search-input').addEventListener('input', (e) => {
                    this.searchTerm = e.target.value.toLowerCase().trim();
                    this.applyFilters();
                });

                // Auto-refresh data every 3 seconds
                setInterval(() => {
                    if (this.isAuthenticated) {
                        this.loadStudents();
                    }
                }, 3000);
            }

            checkAdminSession() {
                const adminSession = localStorage.getItem('admin_session');
                if (adminSession) {
                    try {
                        const session = JSON.parse(adminSession);
                        if (session.expires > Date.now()) {
                            this.isAuthenticated = true;
                            this.showAdminInterface();
                            this.loadStudents();
                        } else {
                            localStorage.removeItem('admin_session');
                        }
                    } catch (error) {
                        localStorage.removeItem('admin_session');
                    }
                }
            }

            handleAdminLogin() {
                const username = document.getElementById('admin-username').value.trim();
                const password = document.getElementById('admin-password').value;

                if (username === this.adminCredentials.username && 
                    password === this.adminCredentials.password) {
                    
                    // Create admin session (expires in 24 hours)
                    const session = {
                        username: username,
                        loginTime: new Date().toISOString(),
                        expires: Date.now() + (24 * 60 * 60 * 1000)
                    };
                    
                    localStorage.setItem('admin_session', JSON.stringify(session));
                    this.isAuthenticated = true;
                    this.showAdminInterface();
                    this.loadStudents();
                    this.showNotification('Successfully logged in as admin!', 'success');
                    
                } else {
                    this.showNotification('Wrong admin username or password!', 'error');
                }
            }

            logout() {
                localStorage.removeItem('admin_session');
                this.isAuthenticated = false;
                this.showAuthInterface();
                this.showNotification('Successfully logged out from admin panel', 'info');
            }

            showAuthInterface() {
                document.getElementById('admin-auth-modal').classList.remove('hidden');
                document.getElementById('admin-nav').classList.add('hidden');
                document.getElementById('admin-main').classList.add('hidden');
            }

            showAdminInterface() {
                document.getElementById('admin-auth-modal').classList.add('hidden');
                document.getElementById('admin-nav').classList.remove('hidden');
                document.getElementById('admin-main').classList.remove('hidden');
            }

            // FIXED: Load data dari sistem siswa (pohon_students)
            loadStudents() {
                try {
                    // Menggunakan key yang sama dengan sistem siswa
                    const studentData = JSON.parse(localStorage.getItem(this.dataKey) || '[]');
                    console.log('üîÑ Admin: Loading students data dari', this.dataKey + ':', studentData);
                    
                    const updatedStudents = studentData.map(student => {
                        const lastActivity = new Date(student.lastActivity || student.lastLogin || student.createdAt);
                        const now = new Date();
                        const minutesSinceLastActivity = (now - lastActivity) / (1000 * 60);
                        
                        student.isOnline = minutesSinceLastActivity < 5;
                        return student;
                    });

                    this.students = updatedStudents;
                    this.applyFilters();
                } catch (error) {
                    console.error('‚ùå Error loading students:', error);
                    this.students = [];
                    this.applyFilters();
                }
            }

            applyFilters() {
                let filtered = [...this.students];

                if (this.searchTerm) {
                    filtered = filtered.filter(student => 
                        student.name.toLowerCase().includes(this.searchTerm) ||
                        student.class.toLowerCase().includes(this.searchTerm) ||
                        (student.password && student.password.includes(this.searchTerm))
                    );
                }

                if (this.selectedClass) {
                    filtered = filtered.filter(student => student.class === this.selectedClass);
                }

                if (this.selectedStatus !== 'all') {
                    filtered = filtered.filter(student => {
                        if (this.selectedStatus === 'online') return student.isOnline === true;
                        if (this.selectedStatus === 'offline') return student.isOnline === false;
                        return true;
                    });
                }

                filtered.sort((a, b) => {
                    return this.sortDescending ? b.points - a.points : a.points - b.points;
                });

                this.filteredStudents = filtered;
                this.updateDisplay();
            }

            updateDisplay() {
                this.updateStatistics();
                this.updateStudentsTable();
                this.updateSearchInfo();
            }

            updateStatistics() {
                const totalStudents = this.students.length;
                const onlineStudents = this.students.filter(s => s.isOnline).length;
                const totalPoints = this.students.reduce((sum, student) => sum + student.points, 0);
                const avgPoints = totalStudents > 0 ? Math.round(totalPoints / totalStudents) : 0;

                document.getElementById('total-students').textContent = totalStudents;
                document.getElementById('online-students').textContent = onlineStudents;
                document.getElementById('total-points').textContent = totalPoints.toLocaleString();
                document.getElementById('avg-points').textContent = avgPoints;
                document.getElementById('avg-points-display').textContent = avgPoints;

                // Update online progress
                const onlinePercent = totalStudents > 0 ? (onlineStudents / totalStudents) * 100 : 0;
                document.getElementById('online-progress').style.width = `${onlinePercent}%`;
            }

            updateStudentsTable() {
                const tbody = document.getElementById('students-table-body');
                const emptyState = document.getElementById('empty-state');
                const noResultsState = document.getElementById('no-results-state');
                const studentCount = document.getElementById('student-count');

                studentCount.innerHTML = `<i class="fas fa-users mr-2"></i><span>${this.filteredStudents.length} adventurers</span>`;

                if (this.students.length === 0) {
                    tbody.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    noResultsState.classList.add('hidden');
                    return;
                }

                if (this.filteredStudents.length === 0) {
                    tbody.innerHTML = '';
                    emptyState.classList.add('hidden');
                    noResultsState.classList.remove('hidden');
                    return;
                }

                emptyState.classList.add('hidden');
                noResultsState.classList.add('hidden');

                tbody.innerHTML = this.filteredStudents.map(student => `
                    <tr class="student-row">
                        <td class="px-6 py-5">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-gradient-to-r from-gold to-bronze rounded-2xl flex items-center justify-center ancient-border text-darkBrown font-semibold">
                                    <i class="fas fa-${student.profileIcon || 'book-reader'} text-lg"></i>
                                </div>
                                <div>
                                    <div class="font-semibold text-dark text-lg">
                                        ${this.highlightSearchTerm(student.name)}
                                    </div>
                                    <div class="text-dark font-medieval text-sm opacity-70">ID: ${student.id.slice(-6)}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-5">
                            <span class="bg-gold/20 text-dark px-4 py-2 rounded-xl text-base font-semibold font-medieval border-2 border-darkBrown">
                                ${student.class}
                            </span>
                        </td>
                        <td class="px-6 py-5">
                            <div class="flex items-center space-x-2">
                                <span class="font-mono text-dark text-lg password-field bg-oldPaper px-3 py-1 rounded border border-darkBrown">
                                    ${student.password || 'not-set'}
                                </span>
                                <button onclick="adminSystem.copyPassword('${student.id}')" class="copy-password text-gold hover:text-bronze text-lg" title="Copy Password">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </td>
                        <td class="px-6 py-5">
                            <div class="flex flex-col space-y-3">
                                <span class="font-bold text-dark text-xl">${student.points.toLocaleString()}</span>
                                <div class="w-32 bg-darkBrown rounded-full h-3">
                                    <div class="rank-progress h-3 rounded-full transition-all duration-1000" 
                                         style="width: ${Math.min(100, (student.points / 1000) * 100)}%"></div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-5">
                            <!-- PERBAIKAN: Rank display dengan class table-rank -->
                            <span class="px-4 py-2 rounded-xl text-base font-semibold border-2 border-darkBrown ${
                                this.getRankColor(student.points)
                            } font-medieval table-rank" title="${this.getRankName(student.points)}">
                                ${this.getRankName(student.points)}
                            </span>
                        </td>
                        <td class="px-6 py-5">
                            <span class="px-4 py-2 rounded-xl text-base font-semibold border-2 border-darkBrown ${
                                student.isOnline ? 'bg-forestGreen/20 text-forestGreen' : 'bg-deepRed/20 text-deepRed'
                            } font-medieval flex items-center">
                                <span class="online-status ${student.isOnline ? 'status-online' : 'status-offline'}"></span>
                                ${student.isOnline ? 'Online' : 'Offline'}
                            </span>
                        </td>
                        <td class="px-6 py-5">
                            <div class="flex flex-col space-y-2">
                                <button onclick="adminSystem.showAddPointsModal('${student.id}')" 
                                        class="bg-gold hover:bg-yellow-600 text-darkBrown px-4 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 border-2 border-darkBrown font-medieval text-base flex items-center justify-center action-btn">
                                    <i class="fas fa-plus mr-2"></i>Add XP
                                </button>
                                <button onclick="adminSystem.resetStudent('${student.id}')" 
                                        class="bg-deepRed hover:bg-red-800 text-parchment px-4 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 border-2 border-gold font-medieval text-base flex items-center justify-center action-btn">
                                    <i class="fas fa-redo mr-2"></i>Reset
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            showAddPointsModal(studentId) {
                this.selectedStudentId = studentId;
                document.getElementById('points-amount').value = 5;
                document.getElementById('add-points-modal').classList.remove('hidden');
            }

            // PERBAIKAN BESAR: Method addPointsToStudent yang benar
            addPointsToStudent() {
                if (!this.selectedStudentId) {
                    this.showNotification('No student selected', 'error');
                    return;
                }

                const points = parseInt(document.getElementById('points-amount').value) || 5;
                console.log('üéØ Admin: Adding points:', points, 'to student:', this.selectedStudentId);

                // PERBAIKAN: Load data terbaru dari localStorage sebelum update
                const currentStudents = JSON.parse(localStorage.getItem(this.dataKey) || '[]');
                
                // Cari student berdasarkan ID
                const studentIndex = currentStudents.findIndex(s => s.id === this.selectedStudentId);
                
                if (studentIndex === -1) {
                    this.showNotification('Student not found', 'error');
                    return;
                }

                // Update data student
                const oldPoints = currentStudents[studentIndex].points;
                currentStudents[studentIndex].points = oldPoints + points;
                currentStudents[studentIndex].lastActivity = new Date().toISOString();
                currentStudents[studentIndex].level = this.getLevelFromPoints(currentStudents[studentIndex].points);

                console.log('‚úÖ Points before:', oldPoints, 'after:', currentStudents[studentIndex].points);

                // PERBAIKAN: Simpan perubahan ke localStorage dan update local state
                localStorage.setItem(this.dataKey, JSON.stringify(currentStudents));
                
                // Update state lokal
                this.students = currentStudents;
                
                this.applyFilters();
                this.closeAddPointsModal();
                
                const studentName = currentStudents[studentIndex].name;
                this.logAdminActivity('add_points', `Added ${points} XP to ${studentName}`);
                this.showNotification(`‚úÖ +${points} XP successfully added to ${studentName}`, 'success');

                // PERBAIKAN BARU: Trigger real-time sync untuk siswa
                this.triggerStudentSync();
            }

            showBulkAddModal(points) {
                this.bulkPoints = points;
                document.getElementById('bulk-points-amount').textContent = points;
                document.getElementById('bulk-add-modal').classList.remove('hidden');
            }

            // PERBAIKAN BESAR: Method addPointsToAllStudents yang benar
            addPointsToAllStudents() {
                const points = this.bulkPoints;
                console.log('üéØ Admin: Adding points to all students:', points);
                
                // PERBAIKAN: Load data terbaru dari localStorage
                const currentStudents = JSON.parse(localStorage.getItem(this.dataKey) || '[]');
                
                let updatedCount = 0;
                currentStudents.forEach((student, index) => {
                    const oldPoints = student.points;
                    currentStudents[index].points = oldPoints + points;
                    currentStudents[index].lastActivity = new Date().toISOString();
                    currentStudents[index].level = this.getLevelFromPoints(currentStudents[index].points);
                    updatedCount++;
                    
                    console.log(`üìä Student ${student.name}: ${oldPoints} -> ${currentStudents[index].points}`);
                });

                // PERBAIKAN: Simpan ke localStorage dan update state
                localStorage.setItem(this.dataKey, JSON.stringify(currentStudents));
                this.students = currentStudents;
                
                this.applyFilters();
                this.closeBulkAddModal();
                
                this.logAdminActivity('bulk_add_points', `Added ${points} XP to all ${updatedCount} students`);
                this.showNotification(`‚úÖ +${points} XP to ${updatedCount} adventurers`, 'success');

                // PERBAIKAN BARU: Trigger real-time sync untuk siswa
                this.triggerStudentSync();
            }

            resetStudent(studentId) {
                if (confirm('Reset this adventurer\'s XP? All progress will be lost.')) {
                    // PERBAIKAN: Load data terbaru dari localStorage
                    const currentStudents = JSON.parse(localStorage.getItem(this.dataKey) || '[]');
                    
                    const studentIndex = currentStudents.findIndex(s => s.id === studentId);
                    if (studentIndex !== -1) {
                        const studentName = currentStudents[studentIndex].name;
                        currentStudents[studentIndex].points = 0;
                        currentStudents[studentIndex].level = 0;
                        currentStudents[studentIndex].lastActivity = new Date().toISOString();
                        
                        // PERBAIKAN: Simpan ke localStorage dan update state
                        localStorage.setItem(this.dataKey, JSON.stringify(currentStudents));
                        this.students = currentStudents;
                        this.applyFilters();
                        
                        this.logAdminActivity('reset_student', `Reset XP for ${studentName}`);
                        this.showNotification(`üîÑ ${studentName}'s XP reset`, 'info');

                        // PERBAIKAN BARU: Trigger real-time sync untuk siswa
                        this.triggerStudentSync();
                    }
                }
            }

            // PERBAIKAN BARU: Method untuk trigger sync ke siswa
            triggerStudentSync() {
                const syncTrigger = {
                    timestamp: Date.now(),
                    type: 'admin_update',
                    message: 'Data updated by admin'
                };
                localStorage.setItem('admin_sync_trigger', JSON.stringify(syncTrigger));
                console.log('üîÑ Admin: Triggering student sync');
                
                // Show sync indicator
                this.showSyncIndicator();
            }

            // PERBAIKAN BARU: Show sync indicator
            showSyncIndicator() {
                const indicator = document.getElementById('sync-indicator');
                if (indicator) {
                    indicator.classList.remove('hidden');
                    indicator.classList.add('sync-active');
                    
                    // Blink effect
                    setTimeout(() => {
                        indicator.classList.remove('sync-active');
                        indicator.classList.add('sync-inactive');
                    }, 1000);
                    
                    setTimeout(() => {
                        indicator.classList.remove('sync-inactive');
                        indicator.classList.add('sync-active');
                    }, 2000);
                }
            }

            // FIXED: Save menggunakan key yang sama dengan sistem siswa
            saveChanges() {
                try {
                    console.log('üíæ Admin: Saving student data to', this.dataKey + ':', this.students);
                    localStorage.setItem(this.dataKey, JSON.stringify(this.students));
                    
                    // Verifikasi penyimpanan
                    const savedData = JSON.parse(localStorage.getItem(this.dataKey) || '[]');
                    console.log('‚úÖ Data saved to', this.dataKey + ':', savedData);
                    
                    this.applyFilters();

                    // Trigger sync untuk siswa
                    this.triggerStudentSync();
                } catch (error) {
                    console.error('‚ùå Error saving data:', error);
                    this.showNotification('Error saving data', 'error');
                }
            }

            // NEW FEATURE: Export all data
            exportAllData() {
                const data = {
                    students: this.students,
                    exportDate: new Date().toISOString(),
                    totalStudents: this.students.length,
                    totalPoints: this.students.reduce((sum, s) => sum + s.points, 0),
                    statistics: this.getStatistics()
                };

                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `forest_adventure_export_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);

                this.logAdminActivity('export_data', 'Exported all system data');
                this.showNotification('üìä Data successfully exported!', 'success');
            }

            getStatistics() {
                return {
                    totalStudents: this.students.length,
                    onlineStudents: this.students.filter(s => s.isOnline).length,
                    totalPoints: this.students.reduce((sum, s) => sum + s.points, 0),
                    averagePoints: Math.round(this.students.reduce((sum, s) => sum + s.points, 0) / this.students.length) || 0,
                    rankDistribution: this.getRankDistribution()
                };
            }

            getRankDistribution() {
                const distribution = {};
                this.students.forEach(student => {
                    const rank = this.getRankName(student.points);
                    distribution[rank] = (distribution[rank] || 0) + 1;
                });
                return distribution;
            }

            // NEW FEATURE: Backup system
            showBackupModal() {
                document.getElementById('backup-modal').classList.remove('hidden');
            }

            closeBackupModal() {
                document.getElementById('backup-modal').classList.add('hidden');
            }

            createBackup() {
                const backup = {
                    students: this.students,
                    timestamp: new Date().toISOString(),
                    version: '1.0',
                    backupId: 'backup_' + Date.now()
                };

                localStorage.setItem(backup.backupId, JSON.stringify(backup));
                this.logAdminActivity('create_backup', 'Created system backup');
                this.showNotification('‚úÖ Backup successfully created!', 'success');
            }

            exportBackup() {
                const backupKeys = Object.keys(localStorage).filter(key => key.startsWith('backup_'));
                if (backupKeys.length === 0) {
                    this.showNotification('No backups available', 'warning');
                    return;
                }

                const latestBackupKey = backupKeys.sort().reverse()[0];
                const backupData = localStorage.getItem(latestBackupKey);
                
                const dataBlob = new Blob([backupData], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `backup_${latestBackupKey}.json`;
                link.click();
                URL.revokeObjectURL(url);

                this.logAdminActivity('export_backup', 'Exported backup data');
                this.showNotification('‚úÖ Backup successfully exported!', 'success');
            }

            // Utility methods
            copyPassword(studentId) {
                const student = this.students.find(s => s.id === studentId);
                if (student && student.password) {
                    navigator.clipboard.writeText(student.password);
                    this.showNotification('Password copied successfully!', 'success');
                } else {
                    this.showNotification('Password not set', 'error');
                }
            }

            refreshData() {
                this.loadStudents();
                this.showNotification('Data successfully refreshed', 'success');
            }

            clearSearch() {
                document.getElementById('search-input').value = '';
                this.searchTerm = '';
                this.selectedClass = '';
                this.selectedStatus = 'all';
                this.updateFilterButtons();
                this.applyFilters();
            }

            filterByClass(className) {
                this.selectedClass = className;
                this.updateFilterButtons();
                this.applyFilters();
            }

            filterByStatus(status) {
                this.selectedStatus = status;
                this.updateFilterButtons();
                this.applyFilters();
            }

            toggleSort() {
                this.sortDescending = !this.sortDescending;
                const sortIcon = document.getElementById('sort-icon');
                const sortText = document.getElementById('sort-text');
                
                if (this.sortDescending) {
                    sortIcon.className = 'fas fa-sort-amount-down mr-2';
                    sortText.textContent = 'Highest XP';
                } else {
                    sortIcon.className = 'fas fa-sort-amount-up mr-2';
                    sortText.textContent = 'Lowest XP';
                }
                
                this.applyFilters();
            }

            updateFilterButtons() {
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                if (this.selectedClass === '') {
                    document.querySelector('.filter-btn:first-child').classList.add('active');
                } else {
                    const classButtons = document.querySelectorAll(`[onclick*="${this.selectedClass}"]`);
                    classButtons.forEach(btn => btn.classList.add('active'));
                }

                const statusButtons = document.querySelectorAll('[onclick*="filterByStatus"]');
                statusButtons.forEach(btn => {
                    if (btn.onclick.toString().includes(this.selectedStatus)) {
                        btn.classList.add('active');
                    }
                });
            }

            updateSearchInfo() {
                const searchInfo = document.getElementById('search-info');
                const resultCount = document.getElementById('result-count');
                const totalCount = document.getElementById('total-count');
                const searchTermDisplay = document.getElementById('search-term-display');

                if (this.searchTerm || this.selectedClass || this.selectedStatus !== 'all') {
                    resultCount.textContent = this.filteredStudents.length;
                    totalCount.textContent = this.students.length;
                    
                    let displayText = '';
                    if (this.searchTerm) {
                        displayText += ` for "${this.searchTerm}"`;
                    }
                    if (this.selectedClass) {
                        displayText += ` in ${this.selectedClass}`;
                    }
                    if (this.selectedStatus !== 'all') {
                        displayText += ` (${this.selectedStatus})`;
                    }
                    
                    searchTermDisplay.textContent = displayText;
                    searchInfo.classList.remove('hidden');
                } else {
                    searchInfo.classList.add('hidden');
                }
            }

            highlightSearchTerm(text) {
                if (!this.searchTerm) return text;
                const regex = new RegExp(`(${this.searchTerm})`, 'gi');
                return text.replace(regex, '<span class="search-highlight">$1</span>');
            }

            closeAddPointsModal() {
                document.getElementById('add-points-modal').classList.add('hidden');
                this.selectedStudentId = null;
            }

            closeBulkAddModal() {
                document.getElementById('bulk-add-modal').classList.add('hidden');
                this.bulkPoints = 0;
            }

            getLevelFromPoints(points) {
                if (points >= 1000) return 5;
                if (points >= 800) return 4;
                if (points >= 600) return 3;
                if (points >= 300) return 2;
                if (points >= 100) return 1;
                return 0;
            }

            getRankName(points) {
                const ranks = ['üå± Seedling', 'üçÉ Forest Sprout', 'üåø Leaf Seeker', 'üå≥ Young Oak', 'üå≤ Ancient Guardian', 'üèÜ Forest Legend'];
                return ranks[this.getLevelFromPoints(points)] || 'üå± Seedling';
            }

            getRankColor(points) {
                const level = this.getLevelFromPoints(points);
                if (level >= 5) return 'bg-gradient-to-r from-red-500 to-yellow-500 text-white';
                if (level >= 4) return 'bg-gradient-to-r from-indigo-500 to-purple-500 text-white';
                if (level >= 3) return 'bg-gradient-to-r from-purple-500 to-blue-500 text-white';
                if (level >= 2) return 'bg-gradient-to-r from-blue-500 to-green-500 text-white';
                if (level >= 1) return 'bg-gradient-to-r from-green-500 to-emerald-500 text-white';
                return 'bg-gradient-to-r from-gray-400 to-gray-600 text-white';
            }

            // NEW FEATURE: Admin activity logging
            logAdminActivity(type, description) {
                try {
                    const logs = JSON.parse(localStorage.getItem('admin_activity_logs') || '[]');
                    logs.push({
                        type: type,
                        description: description,
                        timestamp: new Date().toISOString(),
                        admin: 'admin'
                    });

                    // Keep only last 500 logs
                    if (logs.length > 500) {
                        logs.splice(0, logs.length - 500);
                    }

                    localStorage.setItem('admin_activity_logs', JSON.stringify(logs));
                } catch (error) {
                    console.error('Error logging admin activity:', error);
                }
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `fixed top-6 right-6 z-50 px-6 py-4 rounded-2xl font-semibold text-white transition-all duration-300 transform translate-x-full border-2 ${
                    type === 'error' ? 'bg-deepRed border-red-300' : 
                    type === 'success' ? 'bg-forestGreen border-green-300' : 
                    type === 'warning' ? 'bg-yellow-500 border-yellow-300' : 'bg-mysticBlue border-blue-300'
                } font-medieval text-lg max-w-sm shadow-2xl`;
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => notification.style.transform = 'translateX(0)', 100);

                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => notification.remove(), 300);
                }, 4000);
            }
        }

        // Global functions
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.nextElementSibling.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash text-darkBrown';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye text-darkBrown';
            }
        }

        // Initialize admin system
        const adminSystem = new AdminSystem();
    </script>
</body>
</html>
