<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasi Langit - Panel Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=MedievalSharp&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        skyBlue: '#87CEEB',
                        deepBlue: '#1E3A5F',
                        twilight: '#4A5F7A',
                        starGold: '#FFD700',
                        moonSilver: '#C0C0C0',
                        cloudWhite: '#F8FAFC',
                        nightBlue: '#0F172A',
                        cosmicPurple: '#8B5CF6',
                        nebulaPink: '#EC4899'
                    },
                    fontFamily: {
                        'cinzel': ['Cinzel', 'serif'],
                        'medieval': ['MedievalSharp', 'cursive'],
                        'maguntia': ['UnifrakturMaguntia', 'cursive']
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'twinkle': 'twinkle 2s ease-in-out infinite',
                        'glow': 'glow 3s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-20px)' }
                        },
                        twinkle: {
                            '0%, 100%': { opacity: 0.3 },
                            '50%': { opacity: 1 }
                        },
                        glow: {
                            '0%, 100%': { 
                                'box-shadow': '0 0 20px rgba(255, 215, 0, 0.5)',
                                'transform': 'scale(1)'
                            },
                            '50%': { 
                                'box-shadow': '0 0 40px rgba(255, 215, 0, 0.8)',
                                'transform': 'scale(1.05)'
                            }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #0F172A 0%, #1E3A5F 50%, #4A5F7A 100%);
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(135, 206, 235, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23FFFFFF' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
            min-height: 100vh;
        }
        
        .cosmic-card {
            background: linear-gradient(135deg, rgba(248, 250, 252, 0.95) 0%, rgba(226, 232, 240, 0.9) 100%);
            border: 2px solid #87CEEB;
            box-shadow: 
                0 8px 32px rgba(31, 41, 55, 0.3),
                inset 0 0 20px rgba(135, 206, 235, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .star-border {
            border: 2px solid transparent;
            border-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%2387CEEB' fill-opacity='0.6' fill-rule='evenodd'/%3E%3C/svg%3E") 30 round;
        }
        
        .stats-card {
            transition: all 0.3s ease;
            border: 2px solid #87CEEB;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(135, 206, 235, 0.3);
        }
        
        .student-row {
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(135, 206, 235, 0.3);
        }
        
        .student-row:hover {
            background: linear-gradient(90deg, rgba(135, 206, 235, 0.1), rgba(139, 92, 246, 0.05));
            transform: translateX(4px);
        }
        
        .rank-progress {
            background: linear-gradient(90deg, #FFD700, #8B5CF6);
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
        }

        .text-dark {
            color: #1E293B !important;
        }

        .mobile-container {
            padding-left: 1rem;
            padding-right: 1rem;
        }
        
        @media (min-width: 768px) {
            .mobile-container {
                padding-left: 2rem;
                padding-right: 2rem;
            }
        }

        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: #87CEEB #F8FAFC;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #F8FAFC;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #87CEEB;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #4A5F7A;
        }

        .search-highlight {
            background-color: rgba(255, 215, 0, 0.4);
            border-radius: 3px;
            padding: 0 3px;
            font-weight: 600;
            color: #1E293B !important;
        }

        .filter-btn {
            transition: all 0.3s ease;
            border: 2px solid #87CEEB;
            color: #1E293B !important;
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(135, 206, 235, 0.2);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #FFD700, #87CEEB);
            color: white !important;
            border-color: #87CEEB;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .online-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 6px;
            box-shadow: 0 0 5px currentColor;
        }
        
        .status-online {
            background-color: #22c55e;
        }
        
        .status-offline {
            background-color: #ef4444;
        }

        .action-btn {
            transition: all 0.2s ease;
            border: 1.5px solid;
        }

        .action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            }
            50% { 
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            }
        }

        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(135, 206, 235, 0.2);
        }

        .gradient-text {
            background: linear-gradient(135deg, #FFD700 0%, #87CEEB 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .password-field {
            font-family: monospace;
            letter-spacing: 1px;
        }

        .copy-password {
            transition: all 0.3s ease;
        }

        .copy-password:hover {
            transform: scale(1.1);
            color: #FFD700;
        }
    </style>
</head>
<body class="font-cinzel text-dark min-h-screen">
    <!-- Navigation -->
    <nav class="bg-deepBlue/95 backdrop-blur-md shadow-2xl border-b-2 border-starGold sticky top-0 z-50">
        <div class="mobile-container">
            <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center space-y-4 lg:space-y-0 py-4">
                <!-- Logo & Title -->
                <div class="flex items-center space-x-4 justify-center lg:justify-start">
                    <div class="w-12 h-12 bg-gradient-to-r from-starGold to-cosmicPurple rounded-2xl flex items-center justify-center star-border pulse-glow">
                        <i class="fas fa-user-shield text-nightBlue text-xl"></i>
                    </div>
                    <div class="text-center lg:text-left">
                        <h1 class="text-2xl lg:text-3xl font-bold text-starGold font-maguntia">Fantasi Langit</h1>
                        <p class="text-moonSilver text-sm lg:text-base font-medieval mt-1">Panel Administrator</p>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-3 justify-center lg:justify-end">
                    <button onclick="refreshData()" class="bg-starGold hover:bg-yellow-600 text-nightBlue px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 border-2 border-nightBlue font-medieval text-sm lg:text-base flex items-center justify-center shadow-lg">
                        <i class="fas fa-sync-alt mr-3"></i>Perbarui Data
                    </button>
                    <a href="siswa.html" class="bg-cosmicPurple hover:bg-purple-800 text-cloudWhite px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 border-2 border-starGold font-medieval text-sm lg:text-base flex items-center justify-center shadow-lg">
                        <i class="fas fa-eye mr-3"></i>Lihat Siswa
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="py-6 lg:py-8">
        <div class="mobile-container max-w-7xl mx-auto">
            <!-- Statistics Overview -->
            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
                <div class="stats-card cosmic-card rounded-2xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div class="space-y-2">
                            <div class="text-3xl lg:text-4xl font-bold text-dark" id="total-students">0</div>
                            <div class="text-dark font-medieval text-lg">Total Penjelajah</div>
                        </div>
                        <div class="w-14 h-14 bg-starGold/20 rounded-2xl flex items-center justify-center star-border">
                            <i class="fas fa-users text-starGold text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 w-full bg-cloudWhite rounded-full h-2">
                        <div class="bg-gradient-to-r from-starGold to-cosmicPurple h-2 rounded-full transition-all duration-1000" style="width: 100%"></div>
                    </div>
                </div>

                <div class="stats-card cosmic-card rounded-2xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div class="space-y-2">
                            <div class="text-3xl lg:text-4xl font-bold text-dark" id="online-students">0</div>
                            <div class="text-dark font-medieval text-lg">Sedang Online</div>
                        </div>
                        <div class="w-14 h-14 bg-skyBlue/20 rounded-2xl flex items-center justify-center star-border">
                            <i class="fas fa-wifi text-skyBlue text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 w-full bg-cloudWhite rounded-full h-2">
                        <div class="bg-gradient-to-r from-skyBlue to-deepBlue h-2 rounded-full transition-all duration-1000" id="online-progress" style="width: 0%"></div>
                    </div>
                </div>

                <div class="stats-card cosmic-card rounded-2xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div class="space-y-2">
                            <div class="text-3xl lg:text-4xl font-bold text-dark" id="total-points">0</div>
                            <div class="text-dark font-medieval text-lg">Total Bintang</div>
                        </div>
                        <div class="w-14 h-14 bg-starGold/20 rounded-2xl flex items-center justify-center star-border">
                            <i class="fas fa-star text-starGold text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-dark font-medieval">
                        ⭐ Rata-rata: <span id="avg-points-display">0</span> Bintang
                    </div>
                </div>

                <div class="stats-card cosmic-card rounded-2xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div class="space-y-2">
                            <div class="text-3xl lg:text-4xl font-bold text-dark" id="avg-points">0</div>
                            <div class="text-dark font-medieval text-lg">Rata-rata Bintang</div>
                        </div>
                        <div class="w-14 h-14 bg-cosmicPurple/20 rounded-2xl flex items-center justify-center star-border">
                            <i class="fas fa-chart-line text-cosmicPurple text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-dark font-medieval">
                        📈 Progress sistem
                    </div>
                </div>
            </div>

            <!-- Search and Filter Section -->
            <div class="cosmic-card rounded-2xl p-6 lg:p-8 star-border mb-8">
                <!-- Search Bar -->
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0 mb-6">
                    <div class="flex-1">
                        <div class="relative">
                            <input 
                                type="text" 
                                id="search-input"
                                placeholder="Cari nama penjelajah atau kelas..."
                                class="w-full px-6 py-4 bg-cloudWhite border-3 border-deepBlue rounded-2xl focus:border-starGold focus:ring-4 focus:ring-starGold/20 transition-all duration-300 outline-none font-medieval text-lg placeholder-dark/60 shadow-inner text-dark"
                            >
                            <div class="absolute right-4 top-1/2 transform -translate-y-1/2 text-deepBlue text-xl">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="adminSystem.clearSearch()" class="bg-moonSilver hover:bg-gray-500 text-nightBlue px-6 py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-deepBlue font-medieval text-base flex items-center justify-center action-btn">
                            <i class="fas fa-times mr-2"></i>Clear
                        </button>
                        <button onclick="adminSystem.toggleSort()" class="bg-deepBlue hover:bg-blue-800 text-cloudWhite px-6 py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-starGold font-medieval text-base flex items-center justify-center action-btn">
                            <i class="fas fa-sort-amount-down mr-2" id="sort-icon"></i>
                            <span id="sort-text">Bintang Tertinggi</span>
                        </button>
                    </div>
                </div>

                <!-- Filter by Class -->
                <div class="mb-6">
                    <h3 class="text-dark font-semibold font-medieval text-lg mb-4">Filter Kelas:</h3>
                    <div class="grid grid-cols-3 sm:grid-cols-4 lg:grid-cols-8 gap-3 max-h-48 overflow-y-auto custom-scrollbar">
                        <button onclick="adminSystem.filterByClass('')" class="filter-btn active bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            Semua
                        </button>
                        <!-- Kelas X -->
                        <button onclick="adminSystem.filterByClass('X1')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X1
                        </button>
                        <button onclick="adminSystem.filterByClass('X2')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X2
                        </button>
                        <button onclick="adminSystem.filterByClass('X3')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X3
                        </button>
                        <button onclick="adminSystem.filterByClass('X4')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X4
                        </button>
                        <button onclick="adminSystem.filterByClass('X5')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X5
                        </button>
                        <button onclick="adminSystem.filterByClass('X6')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X6
                        </button>
                        <button onclick="adminSystem.filterByClass('X7')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X7
                        </button>
                        <button onclick="adminSystem.filterByClass('X8')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X8
                        </button>
                        <button onclick="adminSystem.filterByClass('X9')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            X9
                        </button>
                        <!-- Kelas XI MIPA -->
                        <button onclick="adminSystem.filterByClass('XI MIPA 1')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI MIPA 1
                        </button>
                        <button onclick="adminSystem.filterByClass('XI MIPA 2')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI MIPA 2
                        </button>
                        <button onclick="adminSystem.filterByClass('XI MIPA 3')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI MIPA 3
                        </button>
                        <button onclick="adminSystem.filterByClass('XI MIPA 4')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI MIPA 4
                        </button>
                        <button onclick="adminSystem.filterByClass('XI MIPA 5')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI MIPA 5
                        </button>
                        <!-- Kelas XI IPS -->
                        <button onclick="adminSystem.filterByClass('XI IPS 1')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI IPS 1
                        </button>
                        <button onclick="adminSystem.filterByClass('XI IPS 2')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI IPS 2
                        </button>
                        <button onclick="adminSystem.filterByClass('XI IPS 3')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI IPS 3
                        </button>
                        <button onclick="adminSystem.filterByClass('XI IPS 4')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XI IPS 4
                        </button>
                        <!-- Kelas XII MIPA -->
                        <button onclick="adminSystem.filterByClass('XII MIPA 1')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII MIPA 1
                        </button>
                        <button onclick="adminSystem.filterByClass('XII MIPA 2')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII MIPA 2
                        </button>
                        <button onclick="adminSystem.filterByClass('XII MIPA 3')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII MIPA 3
                        </button>
                        <button onclick="adminSystem.filterByClass('XII MIPA 4')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII MIPA 4
                        </button>
                        <button onclick="adminSystem.filterByClass('XII MIPA 5')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII MIPA 5
                        </button>
                        <!-- Kelas XII IPS -->
                        <button onclick="adminSystem.filterByClass('XII IPS 1')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII IPS 1
                        </button>
                        <button onclick="adminSystem.filterByClass('XII IPS 2')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII IPS 2
                        </button>
                        <button onclick="adminSystem.filterByClass('XII IPS 3')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII IPS 3
                        </button>
                        <!-- Kelas XII Bahasa -->
                        <button onclick="adminSystem.filterByClass('XII BAHASA')" class="filter-btn bg-starGold/20 py-3 rounded-xl text-sm font-semibold font-medieval">
                            XII BAHASA
                        </button>
                    </div>
                </div>

                <!-- Status Filter -->
                <div class="mb-4">
                    <h3 class="text-dark font-semibold font-medieval text-lg mb-4">Filter Status:</h3>
                    <div class="flex flex-wrap gap-3">
                        <button onclick="adminSystem.filterByStatus('all')" class="filter-btn active bg-starGold/20 px-6 py-3 rounded-xl text-base font-semibold font-medieval">
                            Semua Status
                        </button>
                        <button onclick="adminSystem.filterByStatus('online')" class="filter-btn bg-starGold/20 px-6 py-3 rounded-xl text-base font-semibold font-medieval">
                            <span class="online-status status-online"></span>Online
                        </button>
                        <button onclick="adminSystem.filterByStatus('offline')" class="filter-btn bg-starGold/20 px-6 py-3 rounded-xl text-base font-semibold font-medieval">
                            <span class="online-status status-offline"></span>Offline
                        </button>
                    </div>
                </div>

                <!-- Search Results Info -->
                <div id="search-info" class="mt-4 p-4 bg-cloudWhite rounded-xl border-2 border-deepBlue text-dark font-medieval text-base hidden">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-info-circle text-starGold"></i>
                        <span>Menampilkan <span class="font-bold text-dark" id="result-count">0</span> dari <span class="font-bold text-dark" id="total-count">0</span> penjelajah</span>
                        <span id="search-term-display" class="font-semibold text-starGold"></span>
                    </div>
                </div>
            </div>

            <!-- Students List Section -->
            <div class="cosmic-card rounded-2xl overflow-hidden star-border mb-8">
                <!-- Header -->
                <div class="px-6 lg:px-8 py-6 border-b-2 border-deepBlue bg-gradient-to-r from-cloudWhite to-skyBlue/20">
                    <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center space-y-4 lg:space-y-0">
                        <div>
                            <h3 class="text-2xl lg:text-3xl font-bold text-dark font-maguntia mb-2">Daftar Penjelajah</h3>
                            <p class="text-dark font-medieval text-lg">Kelola Bintang dan pantau progress</p>
                        </div>
                        <div id="student-count" class="bg-starGold/30 text-nightBlue px-6 py-3 rounded-xl text-base font-semibold border-2 border-deepBlue font-medieval">
                            <i class="fas fa-users mr-2"></i>
                            <span>0 penjelajah</span>
                        </div>
                    </div>
                </div>

                <!-- Table Container -->
                <div class="overflow-x-auto custom-scrollbar">
                    <table class="w-full min-w-[1000px] lg:min-w-full">
                        <thead>
                            <tr class="bg-gradient-to-r from-cloudWhite to-skyBlue/20">
                                <th class="px-6 py-5 text-left font-bold text-dark font-medieval text-lg border-b-2 border-deepBlue">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-user text-starGold"></i>
                                        <span>Nama Penjelajah</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-dark font-medieval text-lg border-b-2 border-deepBlue">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-graduation-cap text-starGold"></i>
                                        <span>Kelas</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-dark font-medieval text-lg border-b-2 border-deepBlue">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-key text-starGold"></i>
                                        <span>Password</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-dark font-medieval text-lg border-b-2 border-deepBlue">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-star text-starGold"></i>
                                        <span>Bintang</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-dark font-medieval text-lg border-b-2 border-deepBlue">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-trophy text-starGold"></i>
                                        <span>Rank</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-dark font-medieval text-lg border-b-2 border-deepBlue">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-signal text-starGold"></i>
                                        <span>Status</span>
                                    </div>
                                </th>
                                <th class="px-6 py-5 text-left font-bold text-dark font-medieval text-lg border-b-2 border-deepBlue">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-cogs text-starGold"></i>
                                        <span>Aksi</span>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="students-table-body" class="table-responsive">
                            <!-- Data siswa akan diisi di sini -->
                        </tbody>
                    </table>
                </div>

                <!-- Empty States -->
                <div class="mobile-text-center mobile-full-width">
                    <div class="mobile-px-4 mobile-py-16 border-t-2 border-deepBlue text-center text-dark font-medieval" id="empty-state">
                        <i class="fas fa-cloud text-6xl mb-6 opacity-40"></i>
                        <p class="text-2xl mb-3">Belum ada penjelajah</p>
                        <p class="text-lg opacity-80">Arahkan siswa untuk login ke sistem</p>
                    </div>

                    <div class="mobile-px-4 mobile-py-16 border-t-2 border-deepBlue text-center text-dark font-medieval hidden" id="no-results-state">
                        <i class="fas fa-search text-6xl mb-6 opacity-40"></i>
                        <p class="text-2xl mb-3">Tidak ditemukan</p>
                        <p class="text-lg opacity-80">Coba dengan kata kunci atau filter lain</p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions Section -->
            <div class="cosmic-card rounded-2xl p-6 lg:p-8 star-border">
                <h3 class="text-2xl lg:text-3xl font-bold text-dark font-maguntia mb-6">Aksi Cepat Tambah Bintang</h3>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6">
                    <button onclick="showBulkAddModal(5)" class="cosmic-card hover:bg-starGold/30 text-dark py-6 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 border-3 border-deepBlue font-medieval text-lg flex flex-col items-center justify-center action-btn shadow-lg">
                        <i class="fas fa-plus-circle text-3xl mb-3 text-starGold"></i>
                        <span>+5 Bintang</span>
                        <span class="text-sm opacity-70 mt-1">Tambah Sedikit</span>
                    </button>
                    <button onclick="showBulkAddModal(15)" class="cosmic-card hover:bg-starGold/30 text-dark py-6 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 border-3 border-deepBlue font-medieval text-lg flex flex-col items-center justify-center action-btn shadow-lg">
                        <i class="fas fa-plus-circle text-3xl mb-3 text-cosmicPurple"></i>
                        <span>+15 Bintang</span>
                        <span class="text-sm opacity-70 mt-1">Tambah Medium</span>
                    </button>
                    <button onclick="showBulkAddModal(20)" class="cosmic-card hover:bg-starGold/30 text-dark py-6 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 border-3 border-deepBlue font-medieval text-lg flex flex-col items-center justify-center action-btn shadow-lg">
                        <i class="fas fa-plus-circle text-3xl mb-3 text-starGold"></i>
                        <span>+20 Bintang</span>
                        <span class="text-sm opacity-70 mt-1">Tambah Banyak</span>
                    </button>
                    <button onclick="showBulkAddModal(30)" class="cosmic-card hover:bg-starGold/30 text-dark py-6 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 border-3 border-deepBlue font-medieval text-lg flex flex-col items-center justify-center action-btn shadow-lg">
                        <i class="fas fa-plus-circle text-3xl mb-3 text-cosmicPurple"></i>
                        <span>+30 Bintang</span>
                        <span class="text-sm opacity-70 mt-1">Tambah Maximum</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Points Modal -->
    <div id="add-points-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center mobile-container backdrop-blur-sm">
        <div class="cosmic-card rounded-2xl p-8 w-full max-w-md star-border transform animate-grow">
            <div class="text-center mb-6">
                <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-starGold to-cosmicPurple rounded-2xl flex items-center justify-center star-border">
                    <i class="fas fa-plus text-nightBlue text-3xl"></i>
                </div>
                <h4 class="text-2xl font-bold text-dark font-maguntia">Tambah Bintang</h4>
            </div>
            <div class="space-y-6">
                <div>
                    <label class="block text-dark font-semibold mb-3 font-medieval text-lg">Jumlah Bintang</label>
                    <input type="number" id="points-amount" 
                           class="w-full px-6 py-4 bg-cloudWhite border-3 border-deepBlue rounded-2xl focus:border-starGold focus:ring-4 focus:ring-starGold/20 transition-all duration-300 outline-none font-medieval text-lg text-center text-dark"
                           min="1" max="100" value="5">
                </div>
                <div class="flex space-x-4">
                    <button onclick="addPointsToStudent()" class="flex-1 bg-starGold hover:bg-yellow-600 text-nightBlue py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-deepBlue font-medieval text-lg shadow-lg hover:scale-105">
                        <i class="fas fa-check mr-2"></i>Tambah Bintang
                    </button>
                    <button onclick="closeAddPointsModal()" class="flex-1 bg-nebulaPink hover:bg-pink-800 text-cloudWhite py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-starGold font-medieval text-lg shadow-lg hover:scale-105">
                        <i class="fas fa-times mr-2"></i>Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Add Modal -->
    <div id="bulk-add-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center mobile-container backdrop-blur-sm">
        <div class="cosmic-card rounded-2xl p-8 w-full max-w-md star-border transform animate-grow">
            <div class="text-center mb-6">
                <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-starGold to-cosmicPurple rounded-2xl flex items-center justify-center star-border">
                    <i class="fas fa-users text-nightBlue text-3xl"></i>
                </div>
                <h4 class="text-2xl font-bold text-dark font-maguntia">Tambah Bintang Massal</h4>
            </div>
            <div class="space-y-6">
                <div class="text-center">
                    <label class="block text-dark font-semibold mb-3 font-medieval text-lg">Jumlah Bintang</label>
                    <div class="text-4xl font-bold text-starGold gradient-text" id="bulk-points-amount">5</div>
                </div>
                <div class="text-center text-dark font-medieval text-lg bg-cloudWhite p-4 rounded-xl border-2 border-deepBlue">
                    <i class="fas fa-info-circle text-starGold mr-2"></i>
                    Bintang akan ditambahkan ke semua penjelajah aktif
                </div>
                <div class="flex space-x-4">
                    <button onclick="addPointsToAllStudents()" class="flex-1 bg-starGold hover:bg-yellow-600 text-nightBlue py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-deepBlue font-medieval text-lg shadow-lg hover:scale-105">
                        <i class="fas fa-bolt mr-2"></i>Tambah Semua
                    </button>
                    <button onclick="closeBulkAddModal()" class="flex-1 bg-nebulaPink hover:bg-pink-800 text-cloudWhite py-4 rounded-2xl font-semibold transition-all duration-300 border-3 border-starGold font-medieval text-lg shadow-lg hover:scale-105">
                        <i class="fas fa-times mr-2"></i>Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class AdminSystem {
            constructor() {
                this.students = [];
                this.filteredStudents = [];
                this.selectedStudentId = null;
                this.bulkPoints = 0;
                this.searchTerm = '';
                this.selectedClass = '';
                this.selectedStatus = 'all';
                this.sortDescending = true;
                this.init();
            }

            init() {
                this.loadStudents();
                this.setupEventListeners();
                this.startAutoRefresh();
                this.checkForNewAccounts();
            }

            loadStudents() {
                try {
                    // PERUBAHAN: Gunakan localStorage yang baru
                    const studentData = JSON.parse(localStorage.getItem('fantasi_langit_admin') || '[]');
                    console.log('Data siswa yang diload dari admin:', studentData);
                    
                    const updatedStudents = studentData.map(student => {
                        const lastActivity = new Date(student.lastActivity || student.lastLogin || student.createdAt);
                        const now = new Date();
                        const minutesSinceLastActivity = (now - lastActivity) / (1000 * 60);
                        
                        student.isOnline = minutesSinceLastActivity < 5;
                        return student;
                    });

                    this.students = updatedStudents;
                    this.applyFilters();
                } catch (error) {
                    console.error('Error loading students:', error);
                    this.students = [];
                    this.applyFilters();
                }
            }

            // FUNGSI BARU: Cek dan sinkronisasi data dari halaman siswa
            checkForNewAccounts() {
                try {
                    // Baca data dari localStorage siswa
                    const siswaData = JSON.parse(localStorage.getItem('fantasi_langit_siswa') || '[]');
                    const adminData = JSON.parse(localStorage.getItem('fantasi_langit_admin') || '[]');
                    
                    console.log('Data dari siswa:', siswaData);
                    console.log('Data dari admin:', adminData);

                    // Cari akun baru yang belum ada di admin
                    const newAccounts = siswaData.filter(siswa => 
                        !adminData.some(admin => admin.id === siswa.id)
                    );

                    if (newAccounts.length > 0) {
                        console.log('Menemukan akun baru dari siswa:', newAccounts);
                        
                        // Gabungkan data
                        const mergedData = [...adminData, ...newAccounts];
                        
                        // Simpan ke localStorage admin
                        localStorage.setItem('fantasi_langit_admin', JSON.stringify(mergedData));
                        
                        // Reload data
                        this.loadStudents();
                        
                        this.showNotification(`Ditemukan ${newAccounts.length} akun baru dari siswa!`, 'success');
                    }
                } catch (error) {
                    console.error('Error checking new accounts:', error);
                }
            }

            setupEventListeners() {
                document.getElementById('search-input').addEventListener('input', (e) => {
                    this.searchTerm = e.target.value.toLowerCase().trim();
                    this.applyFilters();
                });

                setInterval(() => {
                    this.loadStudents();
                }, 3000);
            }

            startAutoRefresh() {
                setInterval(() => {
                    this.loadStudents();
                    this.checkForNewAccounts(); // Cek akun baru secara berkala
                }, 3000);
            }

            applyFilters() {
                let filtered = [...this.students];

                if (this.searchTerm) {
                    filtered = filtered.filter(student => 
                        student.name.toLowerCase().includes(this.searchTerm) ||
                        student.class.toLowerCase().includes(this.searchTerm) ||
                        (student.password && student.password.includes(this.searchTerm))
                    );
                }

                if (this.selectedClass) {
                    filtered = filtered.filter(student => student.class === this.selectedClass);
                }

                if (this.selectedStatus !== 'all') {
                    filtered = filtered.filter(student => {
                        if (this.selectedStatus === 'online') return student.isOnline === true;
                        if (this.selectedStatus === 'offline') return student.isOnline === false;
                        return true;
                    });
                }

                filtered.sort((a, b) => {
                    return this.sortDescending ? b.points - a.points : a.points - b.points;
                });

                this.filteredStudents = filtered;
                this.updateDisplay();
            }

            updateDisplay() {
                this.updateStatistics();
                this.updateStudentsTable();
                this.updateSearchInfo();
            }

            updateStatistics() {
                const totalStudents = this.students.length;
                const onlineStudents = this.students.filter(s => s.isOnline).length;
                const totalPoints = this.students.reduce((sum, student) => sum + student.points, 0);
                const avgPoints = totalStudents > 0 ? Math.round(totalPoints / totalStudents) : 0;

                document.getElementById('total-students').textContent = totalStudents;
                document.getElementById('online-students').textContent = onlineStudents;
                document.getElementById('total-points').textContent = totalPoints.toLocaleString();
                document.getElementById('avg-points').textContent = avgPoints;
                document.getElementById('avg-points-display').textContent = avgPoints;

                // Update online progress
                const onlinePercent = totalStudents > 0 ? (onlineStudents / totalStudents) * 100 : 0;
                document.getElementById('online-progress').style.width = `${onlinePercent}%`;
            }

            updateStudentsTable() {
                const tbody = document.getElementById('students-table-body');
                const emptyState = document.getElementById('empty-state');
                const noResultsState = document.getElementById('no-results-state');
                const studentCount = document.getElementById('student-count');

                studentCount.innerHTML = `<i class="fas fa-users mr-2"></i><span>${this.filteredStudents.length} penjelajah</span>`;

                if (this.students.length === 0) {
                    tbody.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    noResultsState.classList.add('hidden');
                    return;
                }

                if (this.filteredStudents.length === 0) {
                    tbody.innerHTML = '';
                    emptyState.classList.add('hidden');
                    noResultsState.classList.remove('hidden');
                    return;
                }

                emptyState.classList.add('hidden');
                noResultsState.classList.add('hidden');

                tbody.innerHTML = this.filteredStudents.map(student => `
                    <tr class="student-row">
                        <td class="px-6 py-5">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-gradient-to-r from-starGold to-cosmicPurple rounded-2xl flex items-center justify-center star-border text-nightBlue font-semibold">
                                    <i class="fas fa-${student.profileIcon || 'user-astronaut'} text-lg"></i>
                                </div>
                                <div>
                                    <div class="font-semibold text-dark text-lg">
                                        ${this.highlightSearchTerm(student.name)}
                                    </div>
                                    <div class="text-dark font-medieval text-sm opacity-70">ID: ${student.id.slice(-6)}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-5">
                            <span class="bg-starGold/20 text-dark px-4 py-2 rounded-xl text-base font-semibold font-medieval border-2 border-deepBlue">
                                ${student.class}
                            </span>
                        </td>
                        <td class="px-6 py-5">
                            <div class="flex items-center space-x-2">
                                <span class="font-mono text-dark text-lg password-field bg-cloudWhite px-3 py-1 rounded border border-deepBlue">
                                    ${student.password || 'belum-set'}
                                </span>
                                <button onclick="adminSystem.copyPassword('${student.id}')" class="copy-password text-starGold hover:text-cosmicPurple text-lg" title="Salin Password">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </td>
                        <td class="px-6 py-5">
                            <div class="flex flex-col space-y-3">
                                <span class="font-bold text-dark text-xl">${student.points.toLocaleString()}</span>
                                <div class="w-32 bg-deepBlue rounded-full h-3">
                                    <div class="rank-progress h-3 rounded-full transition-all duration-1000" 
                                         style="width: ${Math.min(100, (student.points / 1000) * 100)}%"></div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-5">
                            <span class="px-4 py-2 rounded-xl text-base font-semibold border-2 border-deepBlue ${
                                this.getRankColor(student.points)
                            } font-medieval">
                                ${this.getShortRankName(student.points)}
                            </span>
                        </td>
                        <td class="px-6 py-5">
                            <span class="px-4 py-2 rounded-xl text-base font-semibold border-2 border-deepBlue ${
                                student.isOnline ? 'bg-skyBlue/20 text-skyBlue' : 'bg-nebulaPink/20 text-nebulaPink'
                            } font-medieval flex items-center">
                                <span class="online-status ${student.isOnline ? 'status-online' : 'status-offline'}"></span>
                                ${student.isOnline ? 'Online' : 'Offline'}
                            </span>
                        </td>
                        <td class="px-6 py-5">
                            <div class="flex flex-col space-y-2">
                                <button onclick="adminSystem.showAddPointsModal('${student.id}')" 
                                        class="bg-starGold hover:bg-yellow-600 text-nightBlue px-4 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 border-2 border-deepBlue font-medieval text-base flex items-center justify-center action-btn">
                                    <i class="fas fa-plus mr-2"></i>Tambah Bintang
                                </button>
                                <button onclick="adminSystem.resetStudent('${student.id}')" 
                                        class="bg-nebulaPink hover:bg-pink-800 text-cloudWhite px-4 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 border-2 border-starGold font-medieval text-base flex items-center justify-center action-btn">
                                    <i class="fas fa-redo mr-2"></i>Reset
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            copyPassword(studentId) {
                const student = this.students.find(s => s.id === studentId);
                if (student && student.password) {
                    navigator.clipboard.writeText(student.password);
                    this.showNotification('Password berhasil disalin!', 'success');
                } else {
                    this.showNotification('Password belum diatur', 'error');
                }
            }

            updateSearchInfo() {
                const searchInfo = document.getElementById('search-info');
                const resultCount = document.getElementById('result-count');
                const totalCount = document.getElementById('total-count');
                const searchTermDisplay = document.getElementById('search-term-display');

                if (this.searchTerm || this.selectedClass || this.selectedStatus !== 'all') {
                    resultCount.textContent = this.filteredStudents.length;
                    totalCount.textContent = this.students.length;
                    
                    let displayText = '';
                    if (this.searchTerm) {
                        displayText += ` untuk "${this.searchTerm}"`;
                    }
                    if (this.selectedClass) {
                        displayText += ` di ${this.selectedClass}`;
                    }
                    if (this.selectedStatus !== 'all') {
                        displayText += ` (${this.selectedStatus})`;
                    }
                    
                    searchTermDisplay.textContent = displayText;
                    searchInfo.classList.remove('hidden');
                } else {
                    searchInfo.classList.add('hidden');
                }
            }

            highlightSearchTerm(text) {
                if (!this.searchTerm) return text;
                const regex = new RegExp(`(${this.searchTerm})`, 'gi');
                return text.replace(regex, '<span class="search-highlight">$1</span>');
            }

            clearSearch() {
                document.getElementById('search-input').value = '';
                this.searchTerm = '';
                this.selectedClass = '';
                this.selectedStatus = 'all';
                this.updateFilterButtons();
                this.applyFilters();
            }

            filterByClass(className) {
                this.selectedClass = className;
                this.updateFilterButtons();
                this.applyFilters();
            }

            filterByStatus(status) {
                this.selectedStatus = status;
                this.updateFilterButtons();
                this.applyFilters();
            }

            updateFilterButtons() {
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                if (this.selectedClass === '') {
                    document.querySelector('.filter-btn:first-child').classList.add('active');
                } else {
                    const classButtons = document.querySelectorAll(`[onclick*="${this.selectedClass}"]`);
                    classButtons.forEach(btn => btn.classList.add('active'));
                }

                const statusButtons = document.querySelectorAll('[onclick*="filterByStatus"]');
                statusButtons.forEach(btn => {
                    if (btn.onclick.toString().includes(this.selectedStatus)) {
                        btn.classList.add('active');
                    }
                });
            }

            toggleSort() {
                this.sortDescending = !this.sortDescending;
                const sortIcon = document.getElementById('sort-icon');
                const sortText = document.getElementById('sort-text');
                
                if (this.sortDescending) {
                    sortIcon.className = 'fas fa-sort-amount-down mr-2';
                    sortText.textContent = 'Bintang Tertinggi';
                } else {
                    sortIcon.className = 'fas fa-sort-amount-up mr-2';
                    sortText.textContent = 'Bintang Terendah';
                }
                
                this.applyFilters();
            }

            showAddPointsModal(studentId) {
                this.selectedStudentId = studentId;
                document.getElementById('points-amount').value = 5;
                document.getElementById('add-points-modal').classList.remove('hidden');
            }

            addPointsToStudent() {
                if (!this.selectedStudentId) {
                    this.showNotification('Tidak ada siswa yang dipilih', 'error');
                    return;
                }

                const points = parseInt(document.getElementById('points-amount').value) || 5;
                console.log('Menambah points:', points, 'ke student:', this.selectedStudentId);

                // Cari student berdasarkan ID
                const studentIndex = this.students.findIndex(s => s.id === this.selectedStudentId);
                
                if (studentIndex === -1) {
                    this.showNotification('Siswa tidak ditemukan', 'error');
                    return;
                }

                // Update data student
                const oldPoints = this.students[studentIndex].points;
                this.students[studentIndex].points = oldPoints + points;
                this.students[studentIndex].lastActivity = new Date().toISOString();
                
                // Update level berdasarkan points baru
                this.students[studentIndex].level = this.getLevelFromPoints(this.students[studentIndex].points);

                console.log('Points sebelum:', oldPoints, 'setelah:', this.students[studentIndex].points);

                // Simpan perubahan
                this.saveChanges();
                this.closeAddPointsModal();
                
                const studentName = this.students[studentIndex].name;
                this.showNotification(`+${points} Bintang berhasil ditambahkan ke ${studentName}`, 'success');
            }

            getLevelFromPoints(points) {
                if (points >= 1000) return 5;
                if (points >= 800) return 4;
                if (points >= 600) return 3;
                if (points >= 300) return 2;
                if (points >= 100) return 1;
                return 0;
            }

            showBulkAddModal(points) {
                this.bulkPoints = points;
                document.getElementById('bulk-points-amount').textContent = points;
                document.getElementById('bulk-add-modal').classList.remove('hidden');
            }

            addPointsToAllStudents() {
                const points = this.bulkPoints;
                console.log('Menambah points ke semua siswa:', points);
                
                this.students.forEach((student, index) => {
                    const oldPoints = student.points;
                    this.students[index].points = oldPoints + points;
                    this.students[index].lastActivity = new Date().toISOString();
                    this.students[index].level = this.getLevelFromPoints(this.students[index].points);
                    
                    console.log(`Student ${student.name}: ${oldPoints} -> ${this.students[index].points}`);
                });

                this.saveChanges();
                this.closeBulkAddModal();
                this.showNotification(`+${points} Bintang ke semua penjelajah`, 'success');
            }

            resetStudent(studentId) {
                if (confirm('Reset Bintang penjelajah ini? Semua progress akan hilang.')) {
                    const studentIndex = this.students.findIndex(s => s.id === studentId);
                    if (studentIndex !== -1) {
                        this.students[studentIndex].points = 0;
                        this.students[studentIndex].level = 0;
                        this.students[studentIndex].lastActivity = new Date().toISOString();
                        this.saveChanges();
                        this.showNotification(`Bintang ${this.students[studentIndex].name} direset`, 'info');
                    }
                }
            }

            saveChanges() {
                try {
                    console.log('Menyimpan data siswa:', this.students);
                    // PERUBAHAN: Simpan ke localStorage admin
                    localStorage.setItem('fantasi_langit_admin', JSON.stringify(this.students));
                    
                    // Juga sinkronkan ke localStorage siswa
                    this.syncToSiswaStorage();
                    
                    // Verifikasi penyimpanan
                    const savedData = JSON.parse(localStorage.getItem('fantasi_langit_admin') || '[]');
                    console.log('Data tersimpan di admin:', savedData);
                    
                    this.applyFilters();
                } catch (error) {
                    console.error('Error saving data:', error);
                    this.showNotification('Error menyimpan data', 'error');
                }
            }

            // FUNGSI BARU: Sinkronisasi data ke localStorage siswa
            syncToSiswaStorage() {
                try {
                    const siswaData = JSON.parse(localStorage.getItem('fantasi_langit_siswa') || '[]');
                    
                    // Update data siswa dengan data terbaru dari admin
                    const updatedSiswaData = siswaData.map(siswa => {
                        const adminStudent = this.students.find(admin => admin.id === siswa.id);
                        if (adminStudent) {
                            return {
                                ...siswa,
                                points: adminStudent.points,
                                level: adminStudent.level,
                                lastActivity: adminStudent.lastActivity
                            };
                        }
                        return siswa;
                    });

                    // Tambahkan siswa baru dari admin yang belum ada di siswa
                    this.students.forEach(adminStudent => {
                        if (!updatedSiswaData.some(siswa => siswa.id === adminStudent.id)) {
                            updatedSiswaData.push(adminStudent);
                        }
                    });

                    localStorage.setItem('fantasi_langit_siswa', JSON.stringify(updatedSiswaData));
                    console.log('Data berhasil disinkronisasi ke siswa');
                } catch (error) {
                    console.error('Error syncing to siswa storage:', error);
                }
            }

            closeAddPointsModal() {
                document.getElementById('add-points-modal').classList.add('hidden');
                this.selectedStudentId = null;
            }

            closeBulkAddModal() {
                document.getElementById('bulk-add-modal').classList.add('hidden');
                this.bulkPoints = 0;
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `fixed top-6 right-6 z-50 px-6 py-4 rounded-2xl font-semibold text-white transition-all duration-300 transform translate-x-full border-2 ${
                    type === 'error' ? 'bg-nebulaPink border-pink-300' : 
                    type === 'success' ? 'bg-skyBlue border-blue-300' : 'bg-cosmicPurple border-purple-300'
                } font-medieval text-lg max-w-sm shadow-2xl`;
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => notification.style.transform = 'translateX(0)', 100);

                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => notification.remove(), 300);
                }, 4000);
            }

            getRankName(points) {
                if (points >= 1000) return '🌠 Bintang Maha Raya';
                if (points >= 800) return '⭐ Bintang Kejora';
                if (points >= 600) return '✨ Bintang Gemerlap';
                if (points >= 300) return '🌟 Bintang Bersinar';
                if (points >= 100) return '💫 Bintang Kecil';
                return '☁️ Awan Pertama';
            }

            getShortRankName(points) {
                if (points >= 1000) return '🌠 Maha Raya';
                if (points >= 800) return '⭐ Kejora';
                if (points >= 600) return '✨ Gemerlap';
                if (points >= 300) return '🌟 Bersinar';
                if (points >= 100) return '💫 Kecil';
                return '☁️ Awan';
            }

            getRankColor(points) {
                if (points >= 1000) return 'bg-gradient-to-r from-purple-500 to-pink-500 text-white';
                if (points >= 800) return 'bg-gradient-to-r from-yellow-400 to-orange-500 text-white';
                if (points >= 600) return 'bg-gradient-to-r from-blue-400 to-purple-500 text-white';
                if (points >= 300) return 'bg-gradient-to-r from-green-400 to-blue-500 text-white';
                if (points >= 100) return 'bg-gradient-to-r from-gray-400 to-blue-400 text-white';
                return 'bg-gradient-to-r from-gray-300 to-gray-400 text-gray-700';
            }
        }

        // Global functions
        function showBulkAddModal(points) {
            adminSystem.showBulkAddModal(points);
        }

        function closeAddPointsModal() {
            adminSystem.closeAddPointsModal();
        }

        function closeBulkAddModal() {
            adminSystem.closeBulkAddModal();
        }

        function addPointsToStudent() {
            adminSystem.addPointsToStudent();
        }

        function addPointsToAllStudents() {
            adminSystem.addPointsToAllStudents();
        }

        function refreshData() {
            adminSystem.loadStudents();
            adminSystem.checkForNewAccounts();
            adminSystem.showNotification('Data berhasil diperbarui', 'success');
        }

        // Initialize admin system
        const adminSystem = new AdminSystem();
    </script>
</body>
</html>
